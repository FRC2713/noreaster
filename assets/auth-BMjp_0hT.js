import{r,j as s}from"./index-BFiUEMZJ.js";import{s as l}from"./client-BpMi5cOq.js";function E(){const[p,S]=r.useState(""),[h,v]=r.useState(""),[m,t]=r.useState(null),[o,n]=r.useState(!1),[u,i]=r.useState(!1),[d,w]=r.useState(""),[f,g]=r.useState("");r.useEffect(()=>{async function a(){try{const e=new URL(window.location.href),k=e.searchParams.get("type"),y=e.searchParams.get("code");if(y){const{error:c}=await l.auth.exchangeCodeForSession(y);if(!c){i(!0),window.history.replaceState({},"",e.origin+e.pathname);return}}if(window.location.hash.includes("access_token")){const c=new URLSearchParams(window.location.hash.slice(1)),x=c.get("access_token")??void 0,b=c.get("refresh_token")??void 0;if(x&&b){const{error:N}=await l.auth.setSession({access_token:x,refresh_token:b});if(!N){i(!0),window.history.replaceState({},"",e.origin+e.pathname);return}}}k==="recovery"&&i(!0)}catch{}}a()},[]);async function P(a){a.preventDefault(),t(null),n(!0);try{const{error:e}=await l.auth.signInWithPassword({email:p,password:h});if(e)throw e;t("Signed in!")}catch(e){t(`Error: ${e?.message||"Unable to sign in."}`)}finally{n(!1)}}async function j(a){if(a.preventDefault(),t(null),d.length<8){t("Password must be at least 8 characters.");return}if(d!==f){t("Passwords do not match.");return}n(!0);try{const{error:e}=await l.auth.updateUser({password:d});if(e)throw e;t("Password updated. You can now sign in."),i(!1),w(""),g("")}catch(e){t(`Error: ${e?.message||"Unable to update password."}`)}finally{n(!1)}}return s.jsxs("div",{className:"max-w-sm",children:[s.jsx("h1",{className:"text-2xl font-semibold mb-4",children:u?"Reset password":"Sign in"}),u?s.jsxs("form",{onSubmit:j,className:"space-y-3",children:[s.jsx("input",{type:"password",required:!0,value:d,onChange:a=>w(a.target.value),placeholder:"New password",className:"w-full rounded-md border px-3 py-2 outline-hidden",autoComplete:"new-password"}),s.jsx("input",{type:"password",required:!0,value:f,onChange:a=>g(a.target.value),placeholder:"Confirm new password",className:"w-full rounded-md border px-3 py-2 outline-hidden",autoComplete:"new-password"}),s.jsx("button",{disabled:o,type:"submit",className:"rounded-md bg-black text-white px-3 py-2 hover:opacity-90 disabled:opacity-60 dark:bg-white dark:text-black",children:o?"Saving...":"Update password"})]}):s.jsxs("form",{onSubmit:P,className:"space-y-3",children:[s.jsx("input",{type:"email",required:!0,value:p,onChange:a=>S(a.target.value),placeholder:"you@example.com",className:"w-full rounded-md border px-3 py-2 outline-hidden",autoComplete:"username"}),s.jsx("input",{type:"password",required:!0,value:h,onChange:a=>v(a.target.value),placeholder:"Password",className:"w-full rounded-md border px-3 py-2 outline-hidden",autoComplete:"current-password"}),s.jsx("button",{disabled:o,type:"submit",className:"rounded-md bg-black text-white px-3 py-2 hover:opacity-90 disabled:opacity-60 dark:bg-white dark:text-black",children:o?"Signing in...":"Sign in"})]}),m&&s.jsx("p",{className:"mt-3 text-sm opacity-80",children:m}),!u&&s.jsxs("div",{className:"mt-6 text-sm text-muted-foreground space-y-2",children:[s.jsx("p",{children:"Sign-up is disabled. Ask an admin to create your account or change your password."}),s.jsx("p",{children:"Admins: In Supabase Dashboard → Authentication → Providers → Email, disable new signups. To change a user's password, open Authentication → Users → select user → Reset Password."})]})]})}export{E as default};
