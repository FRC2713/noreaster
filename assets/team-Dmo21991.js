import{j as e,n as re,o as le,p as ne,q as ie,r as oe,s as de,t as ce,u as me,v as ue}from"./ui-vendor-CDBhOMS0.js";import{k as xe,u as ge,r as d,L as K}from"./react-vendor-CNeAGCso.js";import{u as he,c as Q,b as B}from"./query-vendor-BivveeUn.js";import{c,b as V,S as fe,B as A,s as g}from"./index-BKCnwC9K.js";import{C as b,b as y,c as w,a as S}from"./card-C15IIjEe.js";import{L as q,I as $}from"./label-DUXI4H34.js";import{B as z}from"./badge-BBSCdzdz.js";import{R as pe}from"./robot-image-B0Vwlwju.js";import{u as je}from"./use-matches-polling-Cf3FAkTn.js";import{u as Ne}from"./use-alliances-polling-DUy60FBv.js";import{A as ve,c as O,d as be,e as H,f as ye,C as W,T as we}from"./icons-vendor-Db1BlRWD.js";import"./supabase-vendor-B8N91wlh.js";import"./utils-vendor-DCj5grse.js";import"./use-smart-polling-B6JEXDeL.js";function Se({...a}){return e.jsx(re,{"data-slot":"alert-dialog",...a})}function Te({...a}){return e.jsx(le,{"data-slot":"alert-dialog-trigger",...a})}function _e({...a}){return e.jsx(me,{"data-slot":"alert-dialog-portal",...a})}function Ce({className:a,...t}){return e.jsx(ue,{"data-slot":"alert-dialog-overlay",className:c("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50 pointer-events-none data-[state=open]:pointer-events-auto",a),...t})}function De({className:a,...t}){return e.jsxs(_e,{children:[e.jsx(Ce,{}),e.jsx(ne,{"data-slot":"alert-dialog-content",className:c("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",a),...t})]})}function Ae({className:a,...t}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:c("flex flex-col gap-2 text-center sm:text-left",a),...t})}function qe({className:a,...t}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:c("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",a),...t})}function Ee({className:a,...t}){return e.jsx(ie,{"data-slot":"alert-dialog-title",className:c("text-lg font-semibold",a),...t})}function ke({className:a,...t}){return e.jsx(oe,{"data-slot":"alert-dialog-description",className:c("text-muted-foreground text-sm",a),...t})}function Re({className:a,...t}){return e.jsx(ce,{className:c(V(),a),...t})}function Fe({className:a,...t}){return e.jsx(de,{className:c(V({variant:"outline"}),a),...t})}function Le(a=8){const t=new Uint8Array(a);return crypto.getRandomValues(t),Array.from(t,m=>m.toString(16).padStart(2,"0")).join("")}function Je(){const t=xe().teamId,m=he(),G=ge(),{matches:T}=je(),{alliances:E}=Ne(),{data:l,isLoading:J,error:X}=Q({queryKey:["teams","detail",t],queryFn:async()=>{const{data:s,error:r}=await g.from("teams").select("id, number, name, robot_image_url").eq("id",t).single();if(r)throw r;return s}}),{data:Y}=Q({queryKey:["auth","user"],queryFn:async()=>{const{data:{user:s}}=await g.auth.getUser();return{user:s}}}),Z=Y?.user,[k,R]=d.useState(""),[_,F]=d.useState(""),[f,L]=d.useState(null),[C,h]=d.useState(null),[I,M]=d.useState(!1),[p,P]=d.useState(!1);d.useEffect(()=>{l&&(R(String(l.number??"")),F(l.name??""))},[l]);const ee=d.useMemo(()=>f?URL.createObjectURL(f):l?.robot_image_url??null,[f,l]),u=d.useMemo(()=>!l||!T||!E?[]:T.filter(s=>{const r=String(s.red||"").split(",").map(i=>i.trim())||[],o=String(s.blue||"").split(",").map(i=>i.trim())||[];return r.includes(l.number.toString())||o.includes(l.number.toString())}).map(s=>{const o=(String(s.red||"").split(",").map(i=>i.trim())||[]).includes(l.number.toString());return{...s,alliance:o?"red":"blue",allianceName:o?s.red_alliance_id:s.blue_alliance_id,teamScore:o?s.red_score:s.blue_score,opponentScore:o?s.blue_score:s.red_score,won:o?(s.red_score||0)>(s.blue_score||0):(s.blue_score||0)>(s.red_score||0),isTie:s.red_score===s.blue_score&&s.red_score!==null}}).sort((s,r)=>!s.scheduled_at&&!r.scheduled_at?0:s.scheduled_at?r.scheduled_at?new Date(r.scheduled_at).getTime()-new Date(s.scheduled_at).getTime():-1:1),[l,T,E]),x=d.useMemo(()=>{if(!u.length)return null;const s=u.filter(n=>n.teamScore!==null&&n.opponentScore!==null),r=s.filter(n=>n.won).length,o=s.filter(n=>!n.won&&!n.isTie).length,i=s.filter(n=>n.isTie).length,j=s.reduce((n,v)=>n+(v.teamScore||0),0),N=s.length>0?j/s.length:0;return{played:s.length,wins:r,losses:o,ties:i,totalScore:j,avgScore:N,winRate:s.length>0?r/s.length*100:0}},[u]),se=B({mutationFn:async s=>{const{number:r,name:o,file:i}=s;let j=l?.robot_image_url??null;if(i){const n=(i.name.split(".").pop()||"png").toLowerCase(),v=`images/${Date.now()}_${Le(6)}.${n}`,{error:U}=await g.storage.from("robots").upload(v,i,{cacheControl:"3600",upsert:!1,contentType:i.type});if(U)throw U;const{data:ae}=g.storage.from("robots").getPublicUrl(v);j=ae.publicUrl}const{error:N}=await g.from("teams").update({number:r,name:o,robot_image_url:j}).eq("id",t);if(N)throw N},onSuccess:()=>{m.invalidateQueries({queryKey:["teams","list"]}),m.invalidateQueries({queryKey:["teams","detail",t]}),h("Saved successfully!"),L(null),P(!1)},onError:s=>{const r=s instanceof Error?s.message:"Failed to save";h(r)},onSettled:()=>M(!1)}),D=B({mutationFn:async()=>{await g.from("alliance_teams").delete().eq("team_id",t);const{error:s}=await g.from("teams").delete().eq("id",t);if(s)throw s},onSuccess:()=>{m.invalidateQueries({queryKey:["teams","list"]}),m.invalidateQueries({queryKey:["alliances"]}),m.invalidateQueries({queryKey:["matches"]}),G("/teams")},onError:s=>{const r=s instanceof Error?s.message:"Failed to delete team";h(r)}});async function te(s){s.preventDefault(),h(null);const r=Number(k);if(!r||r<=0){h("Enter a valid team number.");return}if(!_.trim()){h("Enter a team name.");return}M(!0),se.mutate({number:r,name:_.trim(),file:f})}return J?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading team..."})]})})}):X||!l?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-600 text-lg",children:"Team not found."}),e.jsx(K,{to:"/teams",className:"text-primary hover:underline mt-2 inline-block",children:"Back to Teams"})]})}):e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(K,{to:"/teams",className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(ve,{className:"w-4 h-4"}),"Back to Teams"]}),e.jsx(fe,{orientation:"vertical",className:"h-6"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Team ",l.number]}),e.jsx("p",{className:"text-lg text-muted-foreground",children:l.name})]})]}),Z&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{onClick:()=>P(!p),variant:p?"outline":"default",className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),p?"Cancel Edit":"Edit Team"]}),e.jsxs(Se,{children:[e.jsx(Te,{asChild:!0,children:e.jsxs(A,{variant:"destructive",className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Delete Team"]})}),e.jsxs(De,{children:[e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Are you sure?"}),e.jsxs(ke,{children:["This action cannot be undone. This will permanently delete Team ",l.number," (",l.name,") and remove them from all alliances and match history."]})]}),e.jsxs(qe,{children:[e.jsx(Fe,{children:"Cancel"}),e.jsx(Re,{onClick:()=>D.mutate(),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:D.isPending,children:D.isPending?"Deleting...":"Delete Team"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[400px_1fr]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Team Robot"]})}),e.jsxs(S,{className:"p-4",children:[e.jsx("div",{className:"rounded-lg overflow-hidden border bg-muted",children:f?e.jsx("img",{src:ee??void 0,alt:"Team robot",className:"w-full h-64 object-cover"}):l?.robot_image_url?e.jsx(pe,{team:l,className:"w-full h-64",ratio:16/9}):e.jsx("div",{className:"w-full h-64 grid place-items-center text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No robot image"})]})})}),p&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(q,{className:"text-sm font-medium",htmlFor:"robot-file",children:"Update Robot Image"}),e.jsx("input",{id:"robot-file",type:"file",accept:"image/*",onChange:s=>L(s.target.files?.[0]??null),className:"w-full rounded-md border px-3 py-2 file:mr-3 file:rounded-md file:border file:px-3 file:py-1.5 file:bg-background"})]})]})]}),x&&e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Season Statistics"]})}),e.jsxs(S,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 rounded-lg bg-blue-50 dark:bg-blue-950/30",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:x.played}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Matches"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-green-50 dark:bg-green-950/30",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.wins}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Wins"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-yellow-50 dark:bg-yellow-950/30",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:x.ties}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ties"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-red-50 dark:bg-red-950/30",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:x.losses}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Losses"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold",children:[x.winRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Win Rate"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:x.avgScore.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Avg Score"})]})]})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[p&&e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),"Edit Team Information"]})}),e.jsx(S,{className:"p-4",children:e.jsxs("form",{onSubmit:te,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{htmlFor:"team-number",className:"text-sm font-medium",children:"Team Number"}),e.jsx($,{id:"team-number",type:"number",min:1,required:!0,value:k,onChange:s=>R(s.target.value),placeholder:"e.g. 6328"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{htmlFor:"team-name",className:"text-sm font-medium",children:"Team Name"}),e.jsx($,{id:"team-name",type:"text",required:!0,value:_,onChange:s=>F(s.target.value),placeholder:"Mechanical Advantage"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{type:"submit",disabled:I,className:"flex items-center gap-2",children:I?"Saving...":"Save Changes"}),C&&e.jsx("span",{className:`text-sm ${C.includes("success")?"text-green-600":"text-red-600"}`,children:C})]})]})})]}),e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),"Match History",u.length>0&&e.jsxs(z,{className:"ml-2",children:[u.length," matches"]})]})}),e.jsx(S,{className:"p-4",children:u.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(W,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No matches played yet"}),e.jsx("p",{className:"text-sm",children:"This team hasn't participated in any matches"})]}):e.jsx("div",{className:"space-y-3",children:u.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-card hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`
                          w-3 h-3 rounded-full ${s.alliance==="red"?"bg-red-500":"bg-blue-500"}
                        `}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name||`Match ${s.id}`}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.scheduled_at?new Date(s.scheduled_at).toLocaleDateString():"Unscheduled"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Score"}),e.jsx("div",{className:"font-semibold",children:s.teamScore??"-"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"vs"}),e.jsx("div",{className:"font-semibold",children:s.opponentScore??"-"})]}),e.jsx("div",{className:"flex items-center gap-1",children:s.isTie?e.jsx(z,{children:"TIE"}):s.won?e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"WIN"})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"LOSS"})})]})]},s.id))})})]})]})]})]})}export{Je as default};
