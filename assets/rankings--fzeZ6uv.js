import{r as m,j as a}from"./index-lE6id6xN.js";import{u as x}from"./useQuery-7wTirhIF.js";import{s as _}from"./client-B5RJIpAJ.js";import{B as M}from"./button-DCweSQNn.js";import{c as g}from"./createLucideIcon-BzkEylSr.js";import"./index-1Kl8EGNo.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],E=g("maximize",w);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]],F=g("minimize",R);async function L(){const{data:n,error:o}=await _.from("alliances").select("id, name").order("name");if(o)throw o;return n??[]}async function z(){const{data:n,error:o}=await _.from("matches").select("id, red_alliance_id, blue_alliance_id, red_score, blue_score, red_coral_rp, red_algae_rp, red_barge_rp, blue_coral_rp, blue_algae_rp, blue_barge_rp");if(o)throw o;return n??[]}function V(){const{data:n=[],isLoading:o,error:b}=x({queryKey:["alliances","list"],queryFn:L}),{data:d=[],isLoading:y,error:v}=x({queryKey:["matches","list"],queryFn:z}),j=m.useMemo(()=>{if(!n.length)return[];const r=new Map;n.forEach(e=>{r.set(e.id,{id:e.id,name:e.name,played:0,wins:0,losses:0,ties:0,totalRp:0,totalScore:0,countedScoreMatches:0})});const c=(e,s)=>{const l=r.get(e);l&&(l.totalRp+=s)};for(const e of d){const s=r.get(e.red_alliance_id),l=r.get(e.blue_alliance_id);if(!s||!l)continue;e.red_score!=null&&e.blue_score!=null&&(s.played+=1,l.played+=1,e.red_score>e.blue_score?(s.wins+=1,l.losses+=1,c(s.id,3)):e.red_score<e.blue_score?(l.wins+=1,s.losses+=1,c(l.id,3)):(s.ties+=1,l.ties+=1,c(s.id,1),c(l.id,1)),c(s.id,(e.red_coral_rp?1:0)+(e.red_algae_rp?1:0)+(e.red_barge_rp?1:0)),c(l.id,(e.blue_coral_rp?1:0)+(e.blue_algae_rp?1:0)+(e.blue_barge_rp?1:0)),s.totalScore+=e.red_score,s.countedScoreMatches+=1,l.totalScore+=e.blue_score,l.countedScoreMatches+=1)}const f=Array.from(r.values()).map(e=>{const s=e.played>0?e.totalRp/e.played:0,l=e.countedScoreMatches>0?e.totalScore/e.countedScoreMatches:0;return{...e,avgRp:s,avgScore:l}});function S(e,s){let l=0,i=0;for(const t of d)(t.red_alliance_id===e||t.blue_alliance_id===e)&&(t.red_alliance_id===s||t.blue_alliance_id===s)&&(t.red_score==null||t.blue_score==null||(t.red_score>t.blue_score?t.red_alliance_id===e?l++:t.red_alliance_id===s&&i++:t.blue_score>t.red_score&&(t.blue_alliance_id===e?l++:t.blue_alliance_id===s&&i++)));return{aWins:l,bWins:i}}return f.sort((e,s)=>{if(s.avgRp!==e.avgRp)return s.avgRp-e.avgRp;const{aWins:l,bWins:i}=S(e.id,s.id);return l!==i?i-l:s.avgScore!==e.avgScore?s.avgScore-e.avgScore:e.name.localeCompare(s.name)}),f.map((e,s)=>({rank:s+1,...e}))},[n,d]),h=o||y,u=b||v,[p,N]=m.useState(!!document.fullscreenElement);m.useEffect(()=>{const r=()=>N(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",r),()=>document.removeEventListener("fullscreenchange",r)},[]);function k(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}return a.jsxs("div",{className:"min-h-dvh w-full p-6 md:p-8 lg:p-10 flex flex-col gap-6 overflow-hidden",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h1",{className:"text-4xl md:text-5xl font-bold tracking-tight",children:"Rankings"}),a.jsx(M,{variant:"ghost",size:"icon",onClick:k,className:"rounded-full size-12","aria-label":p?"Exit full screen":"Enter full screen",title:p?"Exit full screen":"Enter full screen",children:p?a.jsx(F,{className:"size-6"}):a.jsx(E,{className:"size-6"})})]}),h&&a.jsx("p",{className:"text-2xl text-muted-foreground",children:"Loadingâ€¦"}),u&&a.jsx("p",{className:"text-2xl text-red-600",children:String(u)}),!h&&!u&&a.jsx("div",{className:"flex-1 overflow-auto rounded-lg border",children:a.jsxs("table",{className:"w-full text-2xl md:text-3xl",children:[a.jsx("thead",{className:"sticky top-0 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:a.jsxs("tr",{className:"text-left border-b",children:[a.jsx("th",{className:"py-4 px-4",children:"Rank"}),a.jsx("th",{className:"py-4 px-4",children:"Alliance"}),a.jsx("th",{className:"py-4 px-4",children:"Played"}),a.jsx("th",{className:"py-4 px-4",children:"W-L-T"}),a.jsx("th",{className:"py-4 px-4",children:"Avg RP"}),a.jsx("th",{className:"py-4 px-4",children:"Avg Score"})]})}),a.jsx("tbody",{children:j.map((r,c)=>a.jsxs("tr",{className:`border-b ${c%2===0?"bg-muted/30":""}`,children:[a.jsx("td",{className:"py-4 px-4 font-semibold",children:r.rank}),a.jsx("td",{className:"py-4 px-4 font-semibold",children:r.name}),a.jsx("td",{className:"py-4 px-4",children:r.played}),a.jsxs("td",{className:"py-4 px-4",children:[r.wins,"-",r.losses,"-",r.ties]}),a.jsx("td",{className:"py-4 px-4",children:r.avgRp.toFixed(3)}),a.jsx("td",{className:"py-4 px-4",children:r.avgScore.toFixed(1)})]},r.id))})]})})]})}export{V as default};
