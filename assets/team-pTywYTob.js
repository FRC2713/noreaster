import{j as e,m as re,n as le,o as ne,p as ie,q as oe,r as de,s as ce,t as me,u as ue,v as xe}from"./ui-vendor-DO8HNBy7.js";import{k as ge,u as he,r as d,L as K}from"./react-vendor-BE_oCUfB.js";import{u as fe,c as Q,b as B}from"./query-vendor-DCkfz_My.js";import{c as m,b as G,B as q,s as g}from"./index-CxnTeCY0.js";import{C as b,b as y,c as w,a as S}from"./card-COJIcVAE.js";import{L as E,I as $}from"./label-ChIWoXD8.js";import{B as O}from"./badge-CbbOyDid.js";import{R as pe}from"./robot-image-VCtKXIg4.js";import{u as je}from"./use-matches-polling-Sgiz89dp.js";import{u as Ne}from"./use-alliances-polling-CtHLpTf5.js";import{A as ve,c as H,d as be,e as W,f as ye,C as V,T as we}from"./icons-vendor-B85u7KyA.js";import"./supabase-vendor-BfNnX3KH.js";import"./utils-vendor-Dkv1a4Vh.js";function Se({className:a,orientation:s="horizontal",decorative:c=!0,...T}){return e.jsx(re,{"data-slot":"separator",decorative:c,orientation:s,className:m("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",a),...T})}function Te({...a}){return e.jsx(le,{"data-slot":"alert-dialog",...a})}function _e({...a}){return e.jsx(ne,{"data-slot":"alert-dialog-trigger",...a})}function Ce({...a}){return e.jsx(ue,{"data-slot":"alert-dialog-portal",...a})}function De({className:a,...s}){return e.jsx(xe,{"data-slot":"alert-dialog-overlay",className:m("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50 pointer-events-none data-[state=open]:pointer-events-auto",a),...s})}function Ae({className:a,...s}){return e.jsxs(Ce,{children:[e.jsx(De,{}),e.jsx(ie,{"data-slot":"alert-dialog-content",className:m("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",a),...s})]})}function qe({className:a,...s}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:m("flex flex-col gap-2 text-center sm:text-left",a),...s})}function Ee({className:a,...s}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:m("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",a),...s})}function ke({className:a,...s}){return e.jsx(oe,{"data-slot":"alert-dialog-title",className:m("text-lg font-semibold",a),...s})}function Re({className:a,...s}){return e.jsx(de,{"data-slot":"alert-dialog-description",className:m("text-muted-foreground text-sm",a),...s})}function Fe({className:a,...s}){return e.jsx(me,{className:m(G(),a),...s})}function Le({className:a,...s}){return e.jsx(ce,{className:m(G({variant:"outline"}),a),...s})}function Ie(a=8){const s=new Uint8Array(a);return crypto.getRandomValues(s),Array.from(s,c=>c.toString(16).padStart(2,"0")).join("")}function Je(){const s=ge().teamId,c=fe(),T=he(),{matches:_}=je(),{alliances:k}=Ne(),{data:l,isLoading:J,error:X}=Q({queryKey:["teams","detail",s],queryFn:async()=>{const{data:t,error:r}=await g.from("teams").select("id, number, name, robot_image_url").eq("id",s).single();if(r)throw r;return t}}),{data:Y}=Q({queryKey:["auth","user"],queryFn:async()=>{const{data:{user:t}}=await g.auth.getUser();return{user:t}}}),Z=Y?.user,[R,F]=d.useState(""),[C,L]=d.useState(""),[f,I]=d.useState(null),[D,h]=d.useState(null),[M,P]=d.useState(!1),[p,U]=d.useState(!1);d.useEffect(()=>{l&&(F(String(l.number??"")),L(l.name??""))},[l]);const ee=d.useMemo(()=>f?URL.createObjectURL(f):l?.robot_image_url??null,[f,l]),u=d.useMemo(()=>!l||!_||!k?[]:_.filter(t=>{const r=String(t.red||"").split(",").map(i=>i.trim())||[],o=String(t.blue||"").split(",").map(i=>i.trim())||[];return r.includes(l.number.toString())||o.includes(l.number.toString())}).map(t=>{const o=(String(t.red||"").split(",").map(i=>i.trim())||[]).includes(l.number.toString());return{...t,alliance:o?"red":"blue",allianceName:o?t.red_alliance_id:t.blue_alliance_id,teamScore:o?t.red_score:t.blue_score,opponentScore:o?t.blue_score:t.red_score,won:o?(t.red_score||0)>(t.blue_score||0):(t.blue_score||0)>(t.red_score||0),isTie:t.red_score===t.blue_score&&t.red_score!==null}}).sort((t,r)=>!t.scheduled_at&&!r.scheduled_at?0:t.scheduled_at?r.scheduled_at?new Date(r.scheduled_at).getTime()-new Date(t.scheduled_at).getTime():-1:1),[l,_,k]),x=d.useMemo(()=>{if(!u.length)return null;const t=u.filter(n=>n.teamScore!==null&&n.opponentScore!==null),r=t.filter(n=>n.won).length,o=t.filter(n=>!n.won&&!n.isTie).length,i=t.filter(n=>n.isTie).length,j=t.reduce((n,v)=>n+(v.teamScore||0),0),N=t.length>0?j/t.length:0;return{played:t.length,wins:r,losses:o,ties:i,totalScore:j,avgScore:N,winRate:t.length>0?r/t.length*100:0}},[u]),te=B({mutationFn:async t=>{const{number:r,name:o,file:i}=t;let j=l?.robot_image_url??null;if(i){const n=(i.name.split(".").pop()||"png").toLowerCase(),v=`images/${Date.now()}_${Ie(6)}.${n}`,{error:z}=await g.storage.from("robots").upload(v,i,{cacheControl:"3600",upsert:!1,contentType:i.type});if(z)throw z;const{data:ae}=g.storage.from("robots").getPublicUrl(v);j=ae.publicUrl}const{error:N}=await g.from("teams").update({number:r,name:o,robot_image_url:j}).eq("id",s);if(N)throw N},onSuccess:()=>{c.invalidateQueries({queryKey:["teams","list"]}),c.invalidateQueries({queryKey:["teams","detail",s]}),h("Saved successfully!"),I(null),U(!1)},onError:t=>{const r=t instanceof Error?t.message:"Failed to save";h(r)},onSettled:()=>P(!1)}),A=B({mutationFn:async()=>{await g.from("alliance_teams").delete().eq("team_id",s);const{error:t}=await g.from("teams").delete().eq("id",s);if(t)throw t},onSuccess:()=>{c.invalidateQueries({queryKey:["teams","list"]}),c.invalidateQueries({queryKey:["alliances"]}),c.invalidateQueries({queryKey:["matches"]}),T("/teams")},onError:t=>{const r=t instanceof Error?t.message:"Failed to delete team";h(r)}});async function se(t){t.preventDefault(),h(null);const r=Number(R);if(!r||r<=0){h("Enter a valid team number.");return}if(!C.trim()){h("Enter a team name.");return}P(!0),te.mutate({number:r,name:C.trim(),file:f})}return J?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading team..."})]})})}):X||!l?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-600 text-lg",children:"Team not found."}),e.jsx(K,{to:"/teams",className:"text-primary hover:underline mt-2 inline-block",children:"Back to Teams"})]})}):e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(K,{to:"/teams",className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(ve,{className:"w-4 h-4"}),"Back to Teams"]}),e.jsx(Se,{orientation:"vertical",className:"h-6"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Team ",l.number]}),e.jsx("p",{className:"text-lg text-muted-foreground",children:l.name})]})]}),Z&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(q,{onClick:()=>U(!p),variant:p?"outline":"default",className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),p?"Cancel Edit":"Edit Team"]}),e.jsxs(Te,{children:[e.jsx(_e,{asChild:!0,children:e.jsxs(q,{variant:"destructive",className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Delete Team"]})}),e.jsxs(Ae,{children:[e.jsxs(qe,{children:[e.jsx(ke,{children:"Are you sure?"}),e.jsxs(Re,{children:["This action cannot be undone. This will permanently delete Team ",l.number," (",l.name,") and remove them from all alliances and match history."]})]}),e.jsxs(Ee,{children:[e.jsx(Le,{children:"Cancel"}),e.jsx(Fe,{onClick:()=>A.mutate(),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:A.isPending,children:A.isPending?"Deleting...":"Delete Team"})]})]})]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[400px_1fr]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),"Team Robot"]})}),e.jsxs(S,{className:"p-4",children:[e.jsx("div",{className:"rounded-lg overflow-hidden border bg-muted",children:f?e.jsx("img",{src:ee??void 0,alt:"Team robot",className:"w-full h-64 object-cover"}):l?.robot_image_url?e.jsx(pe,{team:l,className:"w-full h-64",ratio:16/9}):e.jsx("div",{className:"w-full h-64 grid place-items-center text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(W,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No robot image"})]})})}),p&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(E,{className:"text-sm font-medium",htmlFor:"robot-file",children:"Update Robot Image"}),e.jsx("input",{id:"robot-file",type:"file",accept:"image/*",onChange:t=>I(t.target.files?.[0]??null),className:"w-full rounded-md border px-3 py-2 file:mr-3 file:rounded-md file:border file:px-3 file:py-1.5 file:bg-background"})]})]})]}),x&&e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Season Statistics"]})}),e.jsxs(S,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 rounded-lg bg-blue-50 dark:bg-blue-950/30",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:x.played}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Matches"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-green-50 dark:bg-green-950/30",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.wins}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Wins"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-yellow-50 dark:bg-yellow-950/30",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:x.ties}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ties"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-red-50 dark:bg-red-950/30",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:x.losses}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Losses"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold",children:[x.winRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Win Rate"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:x.avgScore.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Avg Score"})]})]})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[p&&e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Edit Team Information"]})}),e.jsx(S,{className:"p-4",children:e.jsxs("form",{onSubmit:se,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"team-number",className:"text-sm font-medium",children:"Team Number"}),e.jsx($,{id:"team-number",type:"number",min:1,required:!0,value:R,onChange:t=>F(t.target.value),placeholder:"e.g. 6328"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"team-name",className:"text-sm font-medium",children:"Team Name"}),e.jsx($,{id:"team-name",type:"text",required:!0,value:C,onChange:t=>L(t.target.value),placeholder:"Mechanical Advantage"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{type:"submit",disabled:M,className:"flex items-center gap-2",children:M?"Saving...":"Save Changes"}),D&&e.jsx("span",{className:`text-sm ${D.includes("success")?"text-green-600":"text-red-600"}`,children:D})]})]})})]}),e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Match History",u.length>0&&e.jsxs(O,{className:"ml-2",children:[u.length," matches"]})]})}),e.jsx(S,{className:"p-4",children:u.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(V,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No matches played yet"}),e.jsx("p",{className:"text-sm",children:"This team hasn't participated in any matches"})]}):e.jsx("div",{className:"space-y-3",children:u.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-card hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`
                          w-3 h-3 rounded-full ${t.alliance==="red"?"bg-red-500":"bg-blue-500"}
                        `}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.name||`Match ${t.id}`}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.scheduled_at?new Date(t.scheduled_at).toLocaleDateString():"Unscheduled"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Score"}),e.jsx("div",{className:"font-semibold",children:t.teamScore??"-"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"vs"}),e.jsx("div",{className:"font-semibold",children:t.opponentScore??"-"})]}),e.jsx("div",{className:"flex items-center gap-1",children:t.isTie?e.jsx(O,{children:"TIE"}):t.won?e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"WIN"})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"LOSS"})})]})]},t.id))})})]})]})]})]})}export{Je as default};
