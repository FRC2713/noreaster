import{j as e}from"./ui-vendor-CDBhOMS0.js";import{r as _}from"./react-vendor-CNeAGCso.js";import{c as p}from"./query-vendor-BivveeUn.js";import{s as j}from"./index-DiB4IOcY.js";import{R as w}from"./robot-image-CZe6BrnT.js";import{u as R}from"./use-matches-polling-DH2tC6oT.js";import"./supabase-vendor-B8N91wlh.js";import"./utils-vendor-DCj5grse.js";import"./icons-vendor-Dor2AXrm.js";import"./use-smart-polling-Dq1UeSm6.js";function k(a,c){const n=c.filter(s=>(s.red_alliance_id===a||s.blue_alliance_id===a)&&s.red_score!==null&&s.blue_score!==null);let d=0,l=0,o=0,m=0,x=0,h=0,i=0;for(const s of n){const f=s.red_alliance_id===a,u=f?s.red_score:s.blue_score,b=f?s.blue_score:s.red_score;m+=u,x+=b,h+=f?(s.red_coral_rp?1:0)+(s.red_auto_rp?1:0)+(s.red_barge_rp?1:0):(s.blue_coral_rp?1:0)+(s.blue_auto_rp?1:0)+(s.blue_barge_rp?1:0),i++,u>b?d++:u<b?l++:o++}return{wins:d,losses:l,ties:o,avgScore:i>0?m/i:0,avgOpponentScore:i>0?x/i:0,rankingPointAverage:i>0?h/i:0}}function v({allianceId:a,matches:c,color:n,emblemUrl:d,className:l=""}){const o=_.useMemo(()=>k(a,c),[a,c]),x={red:{bg:"bg-red-600/20",border:"border-red-500/30",text:"text-red-200"},blue:{bg:"bg-blue-600/20",border:"border-blue-500/30",text:"text-blue-200"}}[n];return e.jsx("div",{className:`${x.bg} backdrop-blur-sm rounded-lg p-6 ${l}`,children:e.jsxs("div",{className:"text-white space-y-6",children:[d&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:d,alt:"Alliance Emblem",className:"w-28 h-28 md:w-32 md:h-32 object-contain rounded-lg"})}),e.jsxs("div",{className:"text-3xl md:text-4xl font-bold text-center",children:[o.wins,"-",o.losses,"-",o.ties]})]})})}async function I(a){if(a.length===0)return{};const{data:c,error:n}=await j.from("alliances").select("id, name, emblem_image_url").in("id",a);if(n)throw n;const d={};return(c??[]).forEach(l=>{d[l.id]={name:l.name,emblemUrl:l.emblem_image_url}}),d}async function q(a){if(a.length===0)return[];const{data:c,error:n}=await j.from("alliance_teams").select("id, alliance_id, team_id, slot").in("alliance_id",a);if(n)throw n;return c??[]}async function U(a){if(a.length===0)return[];const{data:c,error:n}=await j.from("teams").select("id, number, name, robot_image_url").in("id",a);if(n)throw n;return c??[]}function Y(){const{matches:a,isLoading:c,error:n}=R(),d=a.filter(t=>t.red_score==null&&t.blue_score==null);d.sort((t,r)=>{const M=t.scheduled_at?new Date(t.scheduled_at).getTime():Number.NEGATIVE_INFINITY,T=r.scheduled_at?new Date(r.scheduled_at).getTime():Number.NEGATIVE_INFINITY;return M-T});const l=d.length>0?d[0]:null,o=_.useMemo(()=>l?[l.red_alliance_id,l.blue_alliance_id].filter(t=>t!==null):[],[l]),{data:m={},isLoading:x,error:h}=p({queryKey:["alliances","data",o.sort().join(",")],queryFn:()=>I(o),enabled:o.length>0}),{data:i=[],isLoading:s,error:f}=p({queryKey:["alliance_teams","byAlliances",o.sort().join(",")],queryFn:()=>q(o),enabled:o.length>0}),u=_.useMemo(()=>Array.from(new Set(i.map(t=>t.team_id))),[i]),{data:b=[],isLoading:y,error:E}=p({queryKey:["teams","byIds",u.sort().join(",")],queryFn:()=>U(u),enabled:u.length>0}),g=_.useMemo(()=>new Map(b.map(t=>[t.id,t])),[b]),A=_.useMemo(()=>{const t=[null,null,null,null];return i.filter(r=>r.alliance_id===l?.red_alliance_id).forEach(r=>{r.slot>=1&&r.slot<=4&&(t[r.slot-1]=g.get(r.team_id)??null)}),t},[i,g,l?.red_alliance_id]),L=_.useMemo(()=>{const t=[null,null,null,null];return i.filter(r=>r.alliance_id===l?.blue_alliance_id).forEach(r=>{r.slot>=1&&r.slot<=4&&(t[r.slot-1]=g.get(r.team_id)??null)}),t},[i,g,l?.blue_alliance_id]),S=c||x||s||y,N=n||h||f||E;return S?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loadingâ€¦"}):N?e.jsxs("p",{className:"text-red-600",children:["Error: ",String(N)]}):l?e.jsx("div",{className:"w-full h-full bg-green-500 flex flex-col justify-end",children:e.jsx("div",{className:"border-t-2 border-white/20 w-full",children:e.jsxs("div",{className:"relative flex w-full",children:[e.jsxs("div",{className:"flex-1 bg-blue-600 flex items-center justify-between px-8 py-4",children:[e.jsx("div",{className:"flex-shrink-0 ml-12",children:l&&e.jsx(v,{allianceId:l.blue_alliance_id??"",matches:a,color:"blue",emblemUrl:l.blue_alliance_id?m[l.blue_alliance_id]?.emblemUrl:null})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-6 text-white",children:l.blue_alliance_id?m[l.blue_alliance_id]?.name??"Blue Alliance":"Blue Alliance"}),e.jsx("div",{className:"flex justify-center",children:L.map((t,r)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-24 h-24 md:w-32 md:h-32 flex-shrink-0 mx-auto mb-2",children:e.jsx(w,{team:t??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full h-full bg-muted rounded-lg",ratio:1})}),t&&e.jsx("div",{className:"text-lg md:text-xl font-semibold text-white drop-shadow-lg",children:t.number})]},`b-${r}`))})]})]}),e.jsxs("div",{className:"flex-1 bg-red-600 flex items-center justify-between px-8 py-4",children:[e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-6 text-white",children:l.red_alliance_id?m[l.red_alliance_id]?.name??"Red Alliance":"Red Alliance"}),e.jsx("div",{className:"flex justify-center",children:A.map((t,r)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-24 h-24 md:w-32 md:h-32 flex-shrink-0 mx-auto mb-2",children:e.jsx(w,{team:t??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full h-full bg-muted rounded-lg",ratio:1})}),t&&e.jsx("div",{className:"text-lg md:text-xl font-semibold text-white drop-shadow-lg",children:t.number})]},`r-${r}`))})]}),e.jsx("div",{className:"flex-shrink-0 mr-12",children:l&&e.jsx(v,{allianceId:l.red_alliance_id??"",matches:a,color:"red",emblemUrl:l.red_alliance_id?m[l.red_alliance_id]?.emblemUrl:null})})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"bg-white/20 backdrop-blur-sm rounded-full p-4 border-4 border-white/30",children:e.jsx("img",{src:"/noreaster/NoreasterLogo.png",alt:"Noreaster Logo",className:"w-32 h-32 md:w-40 md:h-40 object-contain"})})})]})})}):e.jsx("p",{className:"text-muted-foreground",children:"No unplayed matches."})}export{Y as default};
