import{b as I,r as o,j as e,L as y,s as g}from"./index-BmdevC1f.js";import{u as h}from"./useQuery-Cgu6KS9_.js";import{R as w}from"./robot-image-CQ6KlgD1.js";import{B as M}from"./button-0VHX3KvR.js";import{u as T}from"./matches-store-DsfI4gDF.js";import"./react-yI-qG6nv.js";async function U(a){if(a.length===0)return{};const{data:n,error:r}=await g.from("alliances").select("id, name").in("id",a);if(r)throw r;const c={};return(n??[]).forEach(s=>c[s.id]=s.name),c}async function K(a){if(a.length===0)return[];const{data:n,error:r}=await g.from("alliance_teams").select("alliance_id, team_id, slot").in("alliance_id",a).order("slot",{ascending:!0});if(r)throw r;return n??[]}async function P(a){if(a.length===0)return[];const{data:n,error:r}=await g.from("teams").select("id, number, name, robot_image_url").in("id",a);if(r)throw r;return n??[]}function G(){const{matchId:a}=I(),{getMatchById:n,isLoading:r,error:c}=T(),s=o.useMemo(()=>a?n(a):null,[a,n]),i=o.useMemo(()=>s?[s.red_alliance_id,s.blue_alliance_id]:[],[s]),{data:f={},isLoading:L,error:E}=h({queryKey:["alliances","names",i.sort().join(",")],queryFn:()=>U(i),enabled:i.length>0}),{data:d=[],isLoading:A,error:R}=h({queryKey:["alliance_teams","byAlliances",i.sort().join(",")],queryFn:()=>K(i),enabled:i.length>0}),u=o.useMemo(()=>Array.from(new Set(d.map(l=>l.team_id))),[d]),{data:b=[],isLoading:S,error:$}=h({queryKey:["teams","byIds",u.sort().join(",")],queryFn:()=>P(u),enabled:u.length>0}),m=o.useMemo(()=>new Map(b.map(l=>[l.id,l])),[b]),q=o.useMemo(()=>{const l=[null,null,null,null];return d.filter(t=>t.alliance_id===s?.red_alliance_id).forEach(t=>{t.slot>=1&&t.slot<=4&&(l[t.slot-1]=m.get(t.team_id)??null)}),l},[d,m,s?.red_alliance_id]),B=o.useMemo(()=>{const l=[null,null,null,null];return d.filter(t=>t.alliance_id===s?.blue_alliance_id).forEach(t=>{t.slot>=1&&t.slot<=4&&(l[t.slot-1]=m.get(t.team_id)??null)}),l},[d,m,s?.blue_alliance_id]),F=r||L||A||S,_=c||E||R||$;if(!a)return e.jsx("p",{children:"Missing match id"});if(F)return e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading…"});if(_)return e.jsxs("p",{className:"text-red-600",children:["Error: ",String(_)]});if(!s)return e.jsx("p",{children:"Match not found"});const j=f[s.red_alliance_id]??"Red Alliance",p=f[s.blue_alliance_id]??"Blue Alliance",x=s.red_score!==null&&s.blue_score!==null,N=x&&s.red_score>s.blue_score,v=x&&s.blue_score>s.red_score;return e.jsxs("div",{className:"min-h-dvh w-full p-4 md:p-8 lg:p-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(y,{to:"/matches",children:e.jsx(M,{variant:"ghost",children:"← Back to Matches"})}),e.jsx(y,{to:`/matches/${a}`,children:e.jsx(M,{variant:"outline",children:"Edit Match"})})]}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-2xl md:text-3xl opacity-70",children:s.round&&s.match_number?`Round ${s.round} Match ${s.match_number}`:"Match Preview"}),e.jsxs("div",{className:"text-3xl md:text-5xl font-bold",children:[j," vs ",p]}),s.scheduled_at&&e.jsx("div",{className:"text-lg md:text-2xl opacity-70 mt-2",children:new Date(s.scheduled_at).toLocaleString()}),x&&e.jsxs("div",{className:"text-2xl md:text-3xl font-bold mt-4",children:[e.jsx("span",{className:N?"text-yellow-400":"",children:s.red_score}),e.jsx("span",{className:"mx-4",children:"-"}),e.jsx("span",{className:v?"text-yellow-400":"",children:s.blue_score})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-3xl md:text-4xl font-bold mb-4 text-white px-4 py-1 rounded ${N?"bg-red-600 ring-2 ring-yellow-400":"bg-red-600"}`,children:j}),e.jsx("ul",{className:"grid gap-4",children:q.map((l,t)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[240px_1fr] items-center",children:[e.jsx(w,{team:l??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9}),e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",l.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:l.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})})]})},`r-${t}`))})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-3xl md:text-4xl font-bold mb-4 text-white px-4 py-1 rounded ${v?"bg-blue-600 ring-2 ring-yellow-400":"bg-blue-600"}`,children:p}),e.jsx("ul",{className:"grid gap-4",children:B.map((l,t)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[1fr_240px] items-center",children:[e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold text-right",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",l.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:l.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})}),e.jsx(w,{team:l??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9})]})},`b-${t}`))})]})]})]})}export{G as default};
