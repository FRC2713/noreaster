import{r,j as e}from"./index-CitH4m_q.js";import{s as n}from"./client-DE1tIILs.js";import{L as h,I as m}from"./label-CphZZZgp.js";import"./utils-CBfrqCZ4.js";function $(){const[o,k]=r.useState(""),[g,P]=r.useState(""),[f,t]=r.useState(null),[i,d]=r.useState(!1),[w,c]=r.useState(!1),[l,x]=r.useState(""),[y,b]=r.useState("");r.useEffect(()=>{async function a(){try{const s=new URL(window.location.href),u=s.searchParams.get("type"),v=s.searchParams.get("code");if(v){const{error:p}=await n.auth.exchangeCodeForSession(v);if(!p){c(!0),window.history.replaceState({},"",s.origin+s.pathname);return}}if(window.location.hash.includes("access_token")){const p=new URLSearchParams(window.location.hash.slice(1)),j=p.get("access_token")??void 0,S=p.get("refresh_token")??void 0;if(j&&S){const{error:U}=await n.auth.setSession({access_token:j,refresh_token:S});if(!U){c(!0),window.history.replaceState({},"",s.origin+s.pathname);return}}}u==="recovery"&&c(!0)}catch{}}a()},[]);async function N(a){a.preventDefault(),t(null),d(!0);try{const{error:s}=await n.auth.signInWithPassword({email:o,password:g});if(s)throw s;t("Signed in!")}catch(s){t(`Error: ${s?.message||"Unable to sign in."}`)}finally{d(!1)}}async function C(a){if(a.preventDefault(),t(null),!o){t("Enter your email first.");return}try{const s=`${window.location.origin}/noreaster/update-password`,{error:u}=await n.auth.resetPasswordForEmail(o,{redirectTo:s});if(u)throw u;t("Password reset link sent. Check your email.")}catch(s){t(`Error: ${s?.message||"Unable to send reset link."}`)}}async function E(a){if(a.preventDefault(),t(null),l.length<8){t("Password must be at least 8 characters.");return}if(l!==y){t("Passwords do not match.");return}d(!0);try{const{error:s}=await n.auth.updateUser({password:l});if(s)throw s;t("Password updated. You can now sign in."),c(!1),x(""),b("")}catch(s){t(`Error: ${s?.message||"Unable to update password."}`)}finally{d(!1)}}return e.jsxs("div",{className:"max-w-sm",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-4",children:w?"Reset password":"Sign in"}),w?e.jsxs("form",{onSubmit:E,className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(h,{children:"New password"}),e.jsx(m,{type:"password",required:!0,value:l,onChange:a=>x(a.target.value),autoComplete:"new-password"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(h,{children:"Confirm new password"}),e.jsx(m,{type:"password",required:!0,value:y,onChange:a=>b(a.target.value),autoComplete:"new-password"})]}),e.jsx("button",{disabled:i,type:"submit",className:"rounded-md bg-black text-white px-3 py-2 hover:opacity-90 disabled:opacity-60 dark:bg-white dark:text-black",children:i?"Saving...":"Update password"})]}):e.jsxs("form",{onSubmit:N,className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(h,{children:"Email"}),e.jsx(m,{type:"email",required:!0,value:o,onChange:a=>k(a.target.value),autoComplete:"username"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(h,{children:"Password"}),e.jsx(m,{type:"password",required:!0,value:g,onChange:a=>P(a.target.value),autoComplete:"current-password"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{disabled:i,type:"submit",className:"rounded-md bg-black text-white px-3 py-2 hover:opacity-90 disabled:opacity-60 dark:bg-white dark:text-black",children:i?"Signing in...":"Sign in"}),e.jsx("button",{type:"button",onClick:C,className:"text-sm underline opacity-90 hover:opacity-100",children:"Forgot password?"})]})]}),f&&e.jsx("p",{className:"mt-3 text-sm opacity-80",children:f}),!w&&e.jsxs("div",{className:"mt-6 text-sm text-muted-foreground space-y-2",children:[e.jsx("p",{children:"Sign-up is disabled. Ask an admin to create your account or change your password."}),e.jsx("p",{children:"Admins: In Supabase Dashboard → Authentication → Providers → Email, disable new signups. To change a user's password, open Authentication → Users → select user → Reset Password."})]})]})}export{$ as default};
