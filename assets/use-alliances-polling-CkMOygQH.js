import{s}from"./index-DiB4IOcY.js";import{u as i}from"./use-smart-polling-Dq1UeSm6.js";async function L(){const{data:t,error:a}=await s.from("alliances").select("id, name, created_at, emblem_image_url").order("created_at",{ascending:!0});if(a)throw a;return t||[]}async function b(){const{data:t,error:a}=await s.from("teams").select("id, number, name, robot_image_url");if(a)throw a;return t||[]}async function q(){const{data:t,error:a}=await s.from("alliance_teams").select("id, alliance_id, team_id, slot");if(a)throw a;return t||[]}function x(){const{data:t=[],isLoading:a,error:d,dataUpdatedAt:m}=i({queryKey:["alliances","polling"],queryFn:L,refetchInterval:3e4,staleTime:2e4,gcTime:9e5}),{data:o=[],isLoading:u,error:f}=i({queryKey:["teams","polling"],queryFn:b,refetchInterval:6e4,staleTime:3e4,gcTime:1800*1e3}),{data:g=[],isLoading:_,error:p,dataUpdatedAt:h}=i({queryKey:["alliance_teams","polling"],queryFn:q,refetchInterval:3e4,staleTime:2e4,gcTime:900*1e3}),n=t.map(e=>({id:e.id,name:e.name,created_at:e.created_at,emblem_image_url:e.emblem_image_url,teams:[null,null,null,null]})),y=new Map(o.map(e=>[e.id,e]));g.forEach(e=>{const r=n.findIndex(w=>w.id===e.alliance_id);r!==-1&&e.slot>=1&&e.slot<=4&&(n[r].teams[e.slot-1]=y.get(e.team_id)??null)});const A=a||u||_,l=d||f||p,c=Math.max(m||0,h||0),T=e=>e?t.find(r=>r.id===e)?.name??`Alliance ${e}`:"TBD";return{alliances:n,teams:o,isLoading:A,error:l?l instanceof Error?l.message:"Failed to fetch alliances data":null,lastUpdated:c?new Date(c):null,getAllianceName:T}}export{x as u};
