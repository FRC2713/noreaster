import{j as e}from"./ui-vendor-L3tEH77r.js";import{L as p,k as T,r as f}from"./react-vendor-BE_oCUfB.js";import{c as v}from"./query-vendor-DjGQMdFW.js";import{B as N,u as D,s as y}from"./index-OSJmVpKI.js";import{u as C}from"./use-match-BZU1EuE4.js";import{B as h}from"./badge-C2lQKczI.js";import{R as _}from"./robot-image-Bo0NX_8L.js";import{T as E,C as F,a as w}from"./icons-vendor-NdmwdHec.js";import"./supabase-vendor-BfNnX3KH.js";import"./utils-vendor-BC32Okw2.js";function q({match:r,matchId:d,redSlots:s,blueSlots:m,redAllianceName:i,blueAllianceName:o,user:u}){const c=r.red_score!==null&&r.blue_score!==null,n=c&&r.red_score>r.blue_score,t=c&&r.blue_score>r.red_score,a=c&&r.red_score===r.blue_score;return e.jsxs("div",{className:"min-h-dvh w-full p-4 md:p-8 lg:p-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(p,{to:"/matches",children:e.jsx(N,{variant:"ghost",children:"← Back to Matches"})}),u&&e.jsx(p,{to:`/matches/${d}`,children:e.jsx(N,{variant:"outline",children:"Edit Match"})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4",children:r.name||`Match ${r.round}M${r.match_number}`}),c&&e.jsxs("div",{className:"flex items-center justify-center gap-6 mb-6",children:[e.jsx("div",{className:"text-6xl font-bold text-red-600",children:r.red_score}),e.jsx("div",{className:"text-2xl font-medium text-muted-foreground",children:"VS"}),e.jsx("div",{className:"text-6xl font-bold text-blue-600",children:r.blue_score})]}),(r.red_auto_score!==null||r.blue_auto_score!==null)&&e.jsxs("div",{className:"flex items-center justify-center gap-6 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-1",children:"Auto Score"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.red_auto_score??"-"})]}),e.jsx("div",{className:"text-lg font-medium text-muted-foreground",children:"VS"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-1",children:"Auto Score"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.blue_auto_score??"-"})]})]}),c&&e.jsxs("div",{className:"flex justify-center mb-6",children:[n&&e.jsxs(h,{className:"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-200 dark:border-red-800 text-lg px-6 py-3",children:[e.jsx(E,{className:"w-5 h-5 mr-2 text-red-600"}),"Red Alliance Wins!"]}),t&&e.jsxs(h,{className:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-800 text-lg px-6 py-3",children:[e.jsx(E,{className:"w-5 h-5 mr-2 text-blue-600"}),"Blue Alliance Wins!"]}),a&&e.jsx(h,{className:"bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-200 dark:border-yellow-800 text-lg px-6 py-3",children:"It's a Tie!"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-3xl md:text-4xl font-bold mb-4 text-white px-4 py-1 rounded ${n?"bg-red-600 ring-2 ring-yellow-400":"bg-red-600"}`,children:i}),e.jsxs("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-950/20 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-900 dark:text-red-100 mb-2",children:"Ranking Points"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.red_coral_rp&&e.jsx(h,{className:"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-200 dark:border-green-800",children:"✓ Coral"}),r.red_auto_rp&&e.jsx(h,{className:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-800",children:"✓ Auto"}),r.red_barge_rp&&e.jsx(h,{className:"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-200 dark:border-purple-800",children:"✓ Barge"})]})]}),e.jsx("ul",{className:"grid gap-4",children:s.map((l,g)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[240px_1fr] items-center",children:[e.jsx(_,{team:l??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9}),e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",l.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:l.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})})]})},`r-${g}`))})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-3xl md:text-4xl font-bold mb-4 text-white px-4 py-1 rounded ${t?"bg-blue-600 ring-2 ring-yellow-400":"bg-blue-600"}`,children:o}),e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"Ranking Points"}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[r.blue_coral_rp&&e.jsx(h,{className:"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-200 dark:border-green-800",children:"✓ Coral"}),r.blue_auto_rp&&e.jsx(h,{className:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-800",children:"✓ Auto"}),r.blue_barge_rp&&e.jsx(h,{className:"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-200 dark:border-purple-800",children:"✓ Barge"})]})]}),e.jsx("ul",{className:"grid gap-4",children:m.map((l,g)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[1fr_240px] items-center",children:[e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold text-right",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",l.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:l.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})}),e.jsx(_,{team:l??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9})]})},`b-${g}`))})]})]})]})}function I(r){const d=new Date(r).getTime(),s=Date.now(),m=Math.round((d-s)/1e3),i=Math.abs(m),o=60,u=60*o,c=24*u;let n,t;i<u?(n=Math.max(1,Math.round(i/o)),t="min"):i<c?(n=Math.max(1,Math.round(i/u)),t="hr"):(n=Math.max(1,Math.round(i/c)),t=n===1?"day":"days");const a=`${n} ${t}`;return m>0?`in ${a}`:m<0?`${a} ago`:"now"}function W({match:r,matchId:d,redSlots:s,blueSlots:m,redAllianceName:i,blueAllianceName:o,user:u}){let c="Unscheduled",n=e.jsx(F,{className:"w-5 h-5"}),t="text-muted-foreground";if(r.scheduled_at){const a=new Date(r.scheduled_at).getTime(),l=Math.abs(a-Date.now()),g=720*60*1e3;c=l>g?new Date(r.scheduled_at).toLocaleString():I(r.scheduled_at),l<3600*1e3?(t="text-red-600",n=e.jsx(w,{className:"w-5 h-5"})):l<7200*1e3?(t="text-orange-600",n=e.jsx(w,{className:"w-5 h-5"})):l<360*60*1e3&&(t="text-yellow-600",n=e.jsx(w,{className:"w-5 h-5"}))}return e.jsxs("div",{className:"min-h-dvh w-full p-4 md:p-8 lg:p-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(p,{to:"/matches",children:e.jsx(N,{variant:"ghost",children:"← Back to Matches"})}),u&&e.jsx(p,{to:`/matches/${d}`,children:e.jsx(N,{variant:"outline",children:"Edit Match"})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4",children:r.name||`Match ${r.round}M${r.match_number}`}),e.jsxs("div",{className:`flex items-center justify-center gap-2 text-xl font-medium ${t}`,children:[n,e.jsx("span",{children:c})]}),e.jsx("div",{className:"mt-4",children:e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full dark:bg-blue-900/30 dark:text-blue-200",children:"Upcoming Match"})})]}),e.jsx("div",{className:"text-center mb-8",children:e.jsx("div",{className:"text-6xl font-bold text-muted-foreground",children:"VS"})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-4 text-white px-4 py-1 rounded bg-red-600",children:i}),e.jsx("ul",{className:"grid gap-4",children:s.map((a,l)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[240px_1fr] items-center",children:[e.jsx(_,{team:a??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9}),e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",a.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:a.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})})]})},`r-${l}`))})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-4 text-white px-4 py-1 rounded bg-blue-600",children:o}),e.jsx("ul",{className:"grid gap-4",children:m.map((a,l)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[1fr_240px] items-center",children:[e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold text-right",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",a.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:a.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})}),e.jsx(_,{team:a??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9})]})},`b-${l}`))})]})]})]})}async function K(r){if(r.length===0)return{};const{data:d,error:s}=await y.from("alliances").select("id, name").in("id",r);if(s)throw s;const m={};return(d??[]).forEach(i=>m[i.id]=i.name),m}async function P(r){if(r.length===0)return[];const{data:d,error:s}=await y.from("alliance_teams").select("alliance_id, team_id, slot").in("alliance_id",r).order("slot",{ascending:!0});if(s)throw s;return d??[]}async function V(r){if(r.length===0)return[];const{data:d,error:s}=await y.from("teams").select("id, number, name, robot_image_url").in("id",r);if(s)throw s;return d??[]}function se(){const{user:r}=D(),{matchId:d}=T(),{data:s,isLoading:m,error:i}=C(d),o=f.useMemo(()=>s?[s.red_alliance_id,s.blue_alliance_id]:[],[s]),{data:u={},isLoading:c,error:n}=v({queryKey:["alliances","names",o.sort().join(",")],queryFn:()=>K(o),enabled:o.length>0}),{data:t=[],isLoading:a,error:l}=v({queryKey:["alliance_teams","byAlliances",o.sort().join(",")],queryFn:()=>P(o),enabled:o.length>0}),g=f.useMemo(()=>Array.from(new Set(t.map(b=>b.team_id))),[t]),{data:k=[],isLoading:U,error:B}=v({queryKey:["teams","byIds",g.sort().join(",")],queryFn:()=>V(g),enabled:g.length>0}),j=f.useMemo(()=>new Map(k.map(b=>[b.id,b])),[k]),M=f.useMemo(()=>{const b=[null,null,null,null];return t.filter(x=>x.alliance_id===s?.red_alliance_id).forEach(x=>{x.slot>=1&&x.slot<=4&&(b[x.slot-1]=j.get(x.team_id)??null)}),b},[t,j,s?.red_alliance_id]),$=f.useMemo(()=>{const b=[null,null,null,null];return t.filter(x=>x.alliance_id===s?.blue_alliance_id).forEach(x=>{x.slot>=1&&x.slot<=4&&(b[x.slot-1]=j.get(x.team_id)??null)}),b},[t,j,s?.blue_alliance_id]),R=m||c||a||U,A=i||n||l||B;if(!d)return e.jsx("p",{children:"Missing match id"});if(R)return e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading…"});if(A)return e.jsxs("p",{className:"text-red-600",children:["Error: ",String(A)]});if(!s)return e.jsx("p",{children:"Match not found"});const L=u[s.red_alliance_id]??"Red Alliance",S=u[s.blue_alliance_id]??"Blue Alliance";return s.red_score!==null&&s.blue_score!==null?e.jsx(q,{match:s,matchId:d,redSlots:M,blueSlots:$,redAllianceName:L,blueAllianceName:S,user:r}):e.jsx(W,{match:s,matchId:d,redSlots:M,blueSlots:$,redAllianceName:L,blueAllianceName:S,user:r})}export{se as default};
