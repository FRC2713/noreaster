import{j as e}from"./ui-vendor-CDBhOMS0.js";import{k as Q,r as s,L as I}from"./react-vendor-CNeAGCso.js";import{B as E,s as K}from"./index-BKCnwC9K.js";import{u as U,b as F}from"./query-vendor-BivveeUn.js";import{u as T,A as P}from"./alliance-rp-toggles-CEqzSvxU.js";import{u as $}from"./use-alliances-polling-DUy60FBv.js";import"./supabase-vendor-B8N91wlh.js";import"./utils-vendor-DCj5grse.js";import"./icons-vendor-Db1BlRWD.js";import"./use-smart-polling-B6JEXDeL.js";function Z(){const{matchId:t}=Q(),i=U(),{alliances:q}=$(),{data:r,isLoading:L,error:d}=T(t),[o,m]=s.useState(""),[n,g]=s.useState(""),[u,p]=s.useState(""),[c,b]=s.useState(""),[x,h]=s.useState(!1),[_,f]=s.useState(!1),[j,S]=s.useState(!1),[v,N]=s.useState(!1),[y,C]=s.useState(!1),[A,B]=s.useState(!1),[R,k]=s.useState(null);s.useEffect(()=>{r&&(m(r.red_score!=null?String(r.red_score):""),g(r.blue_score!=null?String(r.blue_score):""),p(r.red_auto_score!=null?String(r.red_auto_score):""),b(r.blue_auto_score!=null?String(r.blue_auto_score):""),h(!!r.red_coral_rp),f(!!r.red_auto_rp),S(!!r.red_barge_rp),N(!!r.blue_coral_rp),C(!!r.blue_auto_rp),B(!!r.blue_barge_rp))},[r]);const w=F({mutationFn:async()=>{if(!t)return;const a={red_score:o?Number(o):null,blue_score:n?Number(n):null,red_auto_score:u?Number(u):null,blue_auto_score:c?Number(c):null,red_coral_rp:x,red_auto_rp:_,red_barge_rp:j,blue_coral_rp:v,blue_auto_rp:y,blue_barge_rp:A},{error:l}=await K.from("matches").update(a).eq("id",t);if(l)throw l},onSuccess:()=>{k("Saved."),i.invalidateQueries({queryKey:["matches","polling"]}),i.invalidateQueries({queryKey:["matches","byId",t]})},onError:a=>k(`Save failed: ${a?.message??"Unknown error"}`)});function M(a){return a?q.find(l=>l.id===a)?.name??a:"Unknown Alliance"}return t?L?e.jsx("p",{children:"Loading match…"}):d?e.jsxs("p",{className:"text-red-600",children:["Error: ",String(d)]}):r?e.jsxs("div",{className:"space-y-6 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{to:"/matches",children:e.jsx(E,{variant:"ghost",children:"← Back"})}),e.jsx("h1",{className:"text-2xl font-semibold",children:r.name??"Edit Match"})]}),e.jsxs("div",{className:"rounded-md border p-4",children:[e.jsxs("div",{className:"mb-4 font-semibold text-xl",children:[M(r.red_alliance_id)," vs"," ",M(r.blue_alliance_id)]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 text-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Red Score"}),e.jsx("input",{type:"number",value:o,onChange:a=>m(a.target.value),className:"w-full rounded-md border px-3 py-3 text-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Blue Score"}),e.jsx("input",{type:"number",value:n,onChange:a=>g(a.target.value),className:"w-full rounded-md border px-3 py-3 text-lg"})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 text-lg mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Red Auto Score"}),e.jsx("input",{type:"number",value:u,onChange:a=>p(a.target.value),className:"w-full rounded-md border px-3 py-3 text-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Blue Auto Score"}),e.jsx("input",{type:"number",value:c,onChange:a=>b(a.target.value),className:"w-full rounded-md border px-3 py-3 text-lg"})]})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsx(P,{title:"Red Alliance RP",coral:x,auto:_,barge:j,onCoralChange:h,onAutoChange:f,onBargeChange:S}),e.jsx(P,{title:"Blue Alliance RP",coral:v,auto:y,barge:A,onCoralChange:N,onAutoChange:C,onBargeChange:B})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{onClick:()=>w.mutate(),disabled:w.isPending,children:"Save"}),R&&e.jsx("span",{className:"text-sm opacity-80",children:R})]})]}):e.jsx("p",{children:"Match not found"}):e.jsx("p",{children:"Missing match id"})}export{Z as default};
