import{r as a,j as e,a as O,u as $,L as D}from"./index-CSERWSHO.js";import{u as A}from"./useQuery-wNxdMofr.js";import{u as W}from"./useMutation-NvcwwlDe.js";import{s as N}from"./client-DZZaLhkC.js";import{c as q,B as I}from"./button-D6YOVY0E.js";import{u as X,c as G,b as J}from"./index-BAvvof_U.js";import{u as T}from"./index-BF-EMInH.js";import{u as V}from"./index-CqyjrDa9.js";import{P as L}from"./index-DVBshepL.js";function Y(t){const r=a.useRef({value:t,previous:t});return a.useMemo(()=>(r.current.value!==t&&(r.current.previous=r.current.value,r.current.value=t),r.current.previous),[t])}var k="Switch",[Z,fe]=G(k),[ee,te]=Z(k),F=a.forwardRef((t,r)=>{const{__scopeSwitch:n,name:s,checked:l,defaultChecked:x,required:o,disabled:i,value:d="on",onCheckedChange:g,form:u,..._}=t,[m,h]=a.useState(null),j=T(r,f=>h(f)),v=a.useRef(!1),y=m?u||!!m.closest("form"):!0,[p,S]=X({prop:l,defaultProp:x??!1,onChange:g,caller:k});return e.jsxs(ee,{scope:n,checked:p,disabled:i,children:[e.jsx(L.button,{type:"button",role:"switch","aria-checked":p,"aria-required":o,"data-state":U(p),"data-disabled":i?"":void 0,disabled:i,value:d,..._,ref:j,onClick:J(t.onClick,f=>{S(w=>!w),y&&(v.current=f.isPropagationStopped(),v.current||f.stopPropagation())})}),y&&e.jsx(Q,{control:m,bubbles:!v.current,name:s,value:d,checked:p,required:o,disabled:i,form:u,style:{transform:"translateX(-100%)"}})]})});F.displayName=k;var H="SwitchThumb",K=a.forwardRef((t,r)=>{const{__scopeSwitch:n,...s}=t,l=te(H,n);return e.jsx(L.span,{"data-state":U(l.checked),"data-disabled":l.disabled?"":void 0,...s,ref:r})});K.displayName=H;var se="SwitchBubbleInput",Q=a.forwardRef(({__scopeSwitch:t,control:r,checked:n,bubbles:s=!0,...l},x)=>{const o=a.useRef(null),i=T(o,x),d=Y(n),g=V(r);return a.useEffect(()=>{const u=o.current;if(!u)return;const _=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(_,"checked").set;if(d!==n&&h){const j=new Event("click",{bubbles:s});h.call(u,n),u.dispatchEvent(j)}},[d,n,s]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...l,tabIndex:-1,ref:i,style:{...l.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Q.displayName=se;function U(t){return t?"checked":"unchecked"}var z=F,re=K;const b=a.forwardRef(({className:t,...r},n)=>e.jsx(z,{ref:n,className:q("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...r,children:e.jsx(re,{className:q("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));b.displayName=z.displayName;async function ae(t){const{data:r,error:n}=await N.from("matches").select("id, red_alliance_id, blue_alliance_id, scheduled_at, red_score, blue_score, red_coral_rp, red_algae_rp, red_barge_rp, blue_coral_rp, blue_algae_rp, blue_barge_rp").eq("id",t).single();if(n)throw n;return r??null}async function ne(){const{data:t,error:r}=await N.from("alliances").select("id, name");if(r)throw r;return t??[]}function be(){const{matchId:t}=O(),r=$(),{data:n=[]}=A({queryKey:["alliances","list"],queryFn:ne}),{data:s,isLoading:l,error:x}=A({queryKey:["matches","byId",t],queryFn:async()=>ae(t),enabled:!!t}),[o,i]=a.useState(""),[d,g]=a.useState(""),[u,_]=a.useState(!1),[m,h]=a.useState(!1),[j,v]=a.useState(!1),[y,p]=a.useState(!1),[S,f]=a.useState(!1),[w,R]=a.useState(!1),[P,B]=a.useState(null);a.useEffect(()=>{s&&(i(s.red_score!=null?String(s.red_score):""),g(s.blue_score!=null?String(s.blue_score):""),_(!!s.red_coral_rp),h(!!s.red_algae_rp),v(!!s.red_barge_rp),p(!!s.blue_coral_rp),f(!!s.blue_algae_rp),R(!!s.blue_barge_rp))},[s]);const E=W({mutationFn:async()=>{if(!t)return;const c={red_score:o?Number(o):null,blue_score:d?Number(d):null,red_coral_rp:u,red_algae_rp:m,red_barge_rp:j,blue_coral_rp:y,blue_algae_rp:S,blue_barge_rp:w},{error:C}=await N.from("matches").update(c).eq("id",t);if(C)throw C},onSuccess:()=>{B("Saved."),r.invalidateQueries({queryKey:["matches","list"]}),r.invalidateQueries({queryKey:["matches","byId",t]})},onError:c=>B(`Save failed: ${c?.message??"Unknown error"}`)});function M(c){return n.find(C=>C.id===c)?.name??c}return t?l?e.jsx("p",{children:"Loading match…"}):x?e.jsxs("p",{className:"text-red-600",children:["Error: ",String(x)]}):s?e.jsxs("div",{className:"space-y-6 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{to:"/matches",children:e.jsx(I,{variant:"ghost",children:"← Back"})}),e.jsx("h1",{className:"text-2xl font-semibold",children:"Edit Match"})]}),e.jsxs("div",{className:"rounded-md border p-4",children:[e.jsxs("div",{className:"mb-4 font-semibold text-xl",children:[M(s.red_alliance_id)," vs ",M(s.blue_alliance_id)]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 text-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Red Score"}),e.jsx("input",{type:"number",value:o,onChange:c=>i(c.target.value),className:"w-full rounded-md border px-3 py-3 text-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Blue Score"}),e.jsx("input",{type:"number",value:d,onChange:c=>g(c.target.value),className:"w-full rounded-md border px-3 py-3 text-lg"})]})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsx("div",{className:"font-semibold mb-3 text-lg",children:"Red Alliance RP"}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Coral RP"}),e.jsx(b,{checked:u,onCheckedChange:_})]}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Algae RP"}),e.jsx(b,{checked:m,onCheckedChange:h})]}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Barge RP"}),e.jsx(b,{checked:j,onCheckedChange:v})]})]}),e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsx("div",{className:"font-semibold mb-3 text-lg",children:"Blue Alliance RP"}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Coral RP"}),e.jsx(b,{checked:y,onCheckedChange:p})]}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Algae RP"}),e.jsx(b,{checked:S,onCheckedChange:f})]}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Barge RP"}),e.jsx(b,{checked:w,onCheckedChange:R})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{onClick:()=>E.mutate(),disabled:E.isPending,children:"Save"}),P&&e.jsx("span",{className:"text-sm opacity-80",children:P})]})]}):e.jsx("p",{children:"Match not found"}):e.jsx("p",{children:"Missing match id"})}export{be as default};
