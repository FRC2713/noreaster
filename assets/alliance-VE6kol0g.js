import{a as v,r as o,j as e,L as w}from"./index-CitH4m_q.js";import{s as d}from"./client-DE1tIILs.js";import{R as L}from"./robot-image-DTQCEtSN.js";import{B as q}from"./button-BSrsZHPF.js";import{u as c}from"./useQuery-BoCPfJ8x.js";import"./index-TXk4-9mF.js";import"./index-QZhi8wTH.js";import"./utils-CBfrqCZ4.js";function A(){const{allianceId:s}=v(),[f,g]=o.useState(""),[p,x]=o.useState([null,null,null,null]),{data:i,isLoading:h,error:j}=c({queryKey:["alliances","byId",s],queryFn:async()=>{if(!s)return null;const{data:a,error:r}=await d.from("alliances").select("id, name, created_at").eq("id",s).single();if(r)throw r;return a}}),{data:l=[],isLoading:y,error:b}=c({queryKey:["alliance_teams","byAlliance",s],queryFn:async()=>{if(!s)return[];const{data:a,error:r}=await d.from("alliance_teams").select("team_id, slot").eq("alliance_id",s).order("slot",{ascending:!0});if(r)throw r;return a??[]}}),n=(l??[]).map(a=>a.team_id),{data:m=[],isLoading:N,error:_}=c({queryKey:["teams","byIds",n.sort().join(",")],queryFn:async()=>{if(!n.length)return[];const{data:a,error:r}=await d.from("teams").select("id, number, name, robot_image_url").in("id",n);if(r)throw r;return a??[]},enabled:n.length>0});if(o.useEffect(()=>{i&&g(i.name??"");const a=new Map((m??[]).map(t=>[t.id,t])),r=[null,null,null,null];(l??[]).forEach(t=>{t.slot>=1&&t.slot<=4&&(r[t.slot-1]=a.get(t.team_id)??null)}),x(r)},[i,l,m]),!s)return e.jsx("p",{children:"Missing alliance id"});if(h||y||N)return e.jsx("p",{children:"Loading alliance..."});const u=j||b||_;return u?e.jsxs("p",{className:"text-red-600",children:["Error: ",String(u)]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{to:"/alliances",children:e.jsx(q,{variant:"ghost",children:"← Back"})}),e.jsx("h1",{className:"text-2xl font-semibold",children:f})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:p.map((a,r)=>e.jsxs("div",{className:"border rounded-md overflow-hidden",children:[e.jsx(L,{team:a??{id:"_",number:0,name:"No Team",robot_image_url:null},className:"w-full bg-muted"}),e.jsxs("div",{className:"p-3 text-sm",children:[e.jsxs("div",{className:"opacity-70 mb-1",children:["Slot ",r+1]}),a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium",children:a.number}),e.jsx("div",{className:"opacity-80",children:a.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})]})]},r))})]})}export{A as default};
