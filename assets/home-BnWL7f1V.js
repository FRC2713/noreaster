import{j as r,r as S,L as u}from"./index-1lrkdZKD.js";import{u as m}from"./useQuery-BmSwP_wb.js";import{s as h}from"./client-BsRRs-fS.js";import{M as N}from"./match-card-lgbEgN07.js";import{B as f}from"./button-B12SLEYO.js";import{R}from"./rankings-table-8ENGfRFn.js";import{C as k,a as L,b as A,c as C}from"./card-RExmlnF1.js";import"./index-B2pa_DWj.js";import"./utils-CBfrqCZ4.js";function g({title:l,right:s,children:d,className:_}){return r.jsxs(k,{className:_,children:[r.jsxs(L,{className:"flex flex-row items-center justify-between",children:[r.jsx(A,{className:"text-lg font-semibold",children:l}),s]}),r.jsx(C,{children:d})]})}function M({title:l,actions:s,className:d}){return r.jsxs("div",{className:`flex items-center justify-between ${d??""}`,children:[r.jsx("h1",{className:"text-2xl font-semibold",children:l}),s]})}async function q(){const{data:l,error:s}=await h.from("alliances").select("id, name");if(s)throw s;return l??[]}async function E(){const{data:l,error:s}=await h.from("matches").select("id, red_alliance_id, blue_alliance_id, scheduled_at, red_score, blue_score, red:alliances!matches_red_alliance_id_fkey(name), blue:alliances!matches_blue_alliance_id_fkey(name)").is("red_score",null).is("blue_score",null).order("scheduled_at",{ascending:!0,nullsFirst:!0}).limit(10);if(s)throw s;return l??[]}async function F(){const{data:l,error:s}=await h.from("matches").select("id, red_alliance_id, blue_alliance_id, scheduled_at, red_score, blue_score, red_coral_rp, red_auto_rp, red_barge_rp, blue_coral_rp, blue_auto_rp, blue_barge_rp");if(s)throw s;return l??[]}async function H(){const{data:l,error:s}=await h.from("matches").select("id, red_alliance_id, blue_alliance_id, scheduled_at, red_score, blue_score, red:alliances!matches_red_alliance_id_fkey(name), blue:alliances!matches_blue_alliance_id_fkey(name)").not("red_score","is",null).not("blue_score","is",null).order("scheduled_at",{ascending:!1}).limit(5);if(s)throw s;return l??[]}function G(){const{data:l=[]}=m({queryKey:["alliances","list"],queryFn:q}),{data:s=[],isLoading:d,error:_}=m({queryKey:["matches","upcoming"],queryFn:E}),{data:b=[],isLoading:j,error:x}=m({queryKey:["matches","for-ranking"],queryFn:F}),{data:y=[],isLoading:v,error:p}=m({queryKey:["matches","previous"],queryFn:H});function c(e){return l.find(i=>i.id===e)?.name??e}const w=S.useMemo(()=>{const e=new Map;l.forEach(a=>e.set(a.id,{id:a.id,name:a.name,played:0,totalRp:0,totalScore:0,counted:0}));const i=(a,t)=>{const n=e.get(a);n&&(n.totalRp+=t)};for(const a of b){const t=e.get(a.red_alliance_id),n=e.get(a.blue_alliance_id);!t||!n||!(a.red_score!=null&&a.blue_score!=null)||(t.played+=1,n.played+=1,a.red_score>a.blue_score?i(t.id,3):a.blue_score>a.red_score?i(n.id,3):(i(t.id,1),i(n.id,1)),i(t.id,(a.red_coral_rp?1:0)+(a.red_auto_rp?1:0)+(a.red_barge_rp?1:0)),i(n.id,(a.blue_coral_rp?1:0)+(a.blue_auto_rp?1:0)+(a.blue_barge_rp?1:0)),t.totalScore+=a.red_score,t.counted+=1,n.totalScore+=a.blue_score,n.counted+=1)}const o=Array.from(e.values()).map(a=>({...a,avgRp:a.played>0?a.totalRp/a.played:0,avgScore:a.counted>0?a.totalScore/a.counted:0}));return o.sort((a,t)=>t.avgRp-a.avgRp||t.avgScore-a.avgScore||a.name.localeCompare(t.name)),o.map((a,t)=>({rank:t+1,...a})).slice(0,8)},[l,b]);return r.jsxs("div",{className:"space-y-6",children:[r.jsx(M,{title:"Dashboard",actions:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(u,{to:"/matches",children:r.jsx(f,{variant:"outline",children:"Matches"})}),r.jsx(u,{to:"/rankings",children:r.jsx(f,{variant:"outline",children:"Rankings"})}),r.jsx(u,{to:"/schedule",children:r.jsx(f,{variant:"outline",children:"Schedule"})})]})}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsxs(g,{title:"Upcoming Matches",right:r.jsx(u,{to:"/matches/preview",className:"text-sm underline",children:"Preview"}),children:[d&&r.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading…"}),_&&r.jsx("div",{className:"text-sm text-red-600",children:String(_)}),!d&&!_&&(s.length===0?r.jsx("div",{className:"text-sm text-muted-foreground",children:"No upcoming matches."}):r.jsx("ul",{className:"grid gap-2",children:s.map(e=>{const i=Array.isArray(e.red)?e.red[0]?.name??c(e.red_alliance_id):e.red?.name??c(e.red_alliance_id),o=Array.isArray(e.blue)?e.blue[0]?.name??c(e.blue_alliance_id):e.blue?.name??c(e.blue_alliance_id);return r.jsx("li",{children:r.jsx(N,{scheduledAt:e.scheduled_at,redName:i,blueName:o,redScore:e.red_score,blueScore:e.blue_score,showRelativeTime:!0,editHref:`/matches/${e.id}`})},e.id)})}))]}),r.jsx(g,{title:"Rankings (Top 8)",right:r.jsx(u,{to:"/rankings",className:"text-sm underline",children:"View all"}),children:r.jsxs("div",{className:"overflow-x-auto",children:[j&&r.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading…"}),x&&r.jsx("div",{className:"text-sm text-red-600",children:String(x)}),!j&&!x&&r.jsx(R,{rows:w,showRank:!0,size:"sm"})]})})]}),r.jsxs(g,{title:"Recent Matches",right:r.jsx(u,{to:"/matches",className:"text-sm underline",children:"View all"}),children:[v&&r.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading…"}),p&&r.jsx("div",{className:"text-sm text-red-600",children:String(p)}),!v&&!p&&(y.length===0?r.jsx("div",{className:"text-sm text-muted-foreground",children:"No completed matches."}):r.jsx("ul",{className:"grid gap-2",children:y.map(e=>{const i=Array.isArray(e.red)?e.red[0]?.name??c(e.red_alliance_id):e.red?.name??c(e.red_alliance_id),o=Array.isArray(e.blue)?e.blue[0]?.name??c(e.blue_alliance_id):e.blue?.name??c(e.blue_alliance_id);return r.jsx("li",{children:r.jsx(N,{scheduledAt:e.scheduled_at,redName:i,blueName:o,redScore:e.red_score,blueScore:e.blue_score,editHref:`/matches/${e.id}`})},e.id)})}))]})]})}export{G as default};
