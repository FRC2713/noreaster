import{j as e}from"./ui-vendor-CDBhOMS0.js";import{L as p,k as T,r as f}from"./react-vendor-CNeAGCso.js";import{c as v}from"./query-vendor-BivveeUn.js";import{B as N,u as D,s as y}from"./index-eDSu_bsY.js";import{u as C}from"./use-match-CqNIaCfd.js";import{B as h}from"./badge-BnvX8RUh.js";import{R as _}from"./robot-image-CeQQZJTi.js";import{T as E,C as F,a as w}from"./icons-vendor-Db1BlRWD.js";import"./supabase-vendor-B8N91wlh.js";import"./utils-vendor-DCj5grse.js";function q({match:l,matchId:d,redSlots:r,blueSlots:m,redAllianceName:i,blueAllianceName:o,user:b}){const c=l.red_score!==null&&l.blue_score!==null,n=c&&l.red_score>l.blue_score,t=c&&l.blue_score>l.red_score,a=c&&l.red_score===l.blue_score;return e.jsxs("div",{className:"min-h-dvh w-full p-4 md:p-8 lg:p-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(p,{to:"/matches",children:e.jsx(N,{variant:"ghost",children:"← Back to Matches"})}),b&&e.jsx(p,{to:`/matches/${d}`,children:e.jsx(N,{variant:"outline",children:"Edit Match"})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4",children:l.name||`Match ${l.round}M${l.match_number}`}),c&&e.jsxs("div",{className:"flex items-center justify-center gap-6 mb-6",children:[e.jsx("div",{className:"text-6xl font-bold text-red-600",children:l.red_score}),e.jsx("div",{className:"text-2xl font-medium text-muted-foreground",children:"VS"}),e.jsx("div",{className:"text-6xl font-bold text-blue-600",children:l.blue_score})]}),(l.red_auto_score!==null||l.blue_auto_score!==null)&&e.jsxs("div",{className:"flex items-center justify-center gap-6 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-1",children:"Auto Score"}),e.jsx("div",{className:"text-2xl font-bold text-red-600",children:l.red_auto_score??"-"})]}),e.jsx("div",{className:"text-lg font-medium text-muted-foreground",children:"VS"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-1",children:"Auto Score"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:l.blue_auto_score??"-"})]})]}),c&&e.jsxs("div",{className:"flex justify-center mb-6",children:[n&&e.jsxs(h,{className:"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-200 dark:border-red-800 text-lg px-6 py-3",children:[e.jsx(E,{className:"w-5 h-5 mr-2 text-red-600"}),"Red Alliance Wins!"]}),t&&e.jsxs(h,{className:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-800 text-lg px-6 py-3",children:[e.jsx(E,{className:"w-5 h-5 mr-2 text-blue-600"}),"Blue Alliance Wins!"]}),a&&e.jsx(h,{className:"bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-200 dark:border-yellow-800 text-lg px-6 py-3",children:"It's a Tie!"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-3xl md:text-4xl font-bold mb-4 text-white px-4 py-1 rounded ${n?"bg-red-600 ring-2 ring-yellow-400":"bg-red-600"}`,children:i}),e.jsxs("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-950/20 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-900 dark:text-red-100 mb-2",children:"Ranking Points"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.red_coral_rp&&e.jsx(h,{className:"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-200 dark:border-green-800",children:"✓ Coral"}),l.red_auto_rp&&e.jsx(h,{className:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-800",children:"✓ Auto"}),l.red_barge_rp&&e.jsx(h,{className:"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-200 dark:border-purple-800",children:"✓ Barge"})]})]}),e.jsx("ul",{className:"grid gap-4",children:r.map((s,g)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[240px_1fr] items-center",children:[e.jsx(_,{team:s??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9}),e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",s.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:s.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})})]})},`r-${g}`))})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-3xl md:text-4xl font-bold mb-4 text-white px-4 py-1 rounded ${t?"bg-blue-600 ring-2 ring-yellow-400":"bg-blue-600"}`,children:o}),e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"Ranking Points"}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[l.blue_coral_rp&&e.jsx(h,{className:"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-200 dark:border-green-800",children:"✓ Coral"}),l.blue_auto_rp&&e.jsx(h,{className:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-200 dark:border-blue-800",children:"✓ Auto"}),l.blue_barge_rp&&e.jsx(h,{className:"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-200 dark:border-purple-800",children:"✓ Barge"})]})]}),e.jsx("ul",{className:"grid gap-4",children:m.map((s,g)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[1fr_240px] items-center",children:[e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold text-right",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",s.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:s.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})}),e.jsx(_,{team:s??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9})]})},`b-${g}`))})]})]})]})}function I(l){const d=new Date(l).getTime(),r=Date.now(),m=Math.round((d-r)/1e3),i=Math.abs(m),o=60,b=60*o,c=24*b;let n,t;i<b?(n=Math.max(1,Math.round(i/o)),t="min"):i<c?(n=Math.max(1,Math.round(i/b)),t="hr"):(n=Math.max(1,Math.round(i/c)),t=n===1?"day":"days");const a=`${n} ${t}`;return m>0?`in ${a}`:m<0?`${a} ago`:"now"}function W({match:l,matchId:d,redSlots:r,blueSlots:m,redAllianceName:i,blueAllianceName:o,user:b}){let c="Unscheduled",n=e.jsx(F,{className:"w-5 h-5"}),t="text-muted-foreground";if(l.scheduled_at){const a=new Date(l.scheduled_at).getTime(),s=Math.abs(a-Date.now()),g=720*60*1e3;c=s>g?new Date(l.scheduled_at).toLocaleString():I(l.scheduled_at),s<3600*1e3?(t="text-red-600",n=e.jsx(w,{className:"w-5 h-5"})):s<7200*1e3?(t="text-orange-600",n=e.jsx(w,{className:"w-5 h-5"})):s<360*60*1e3&&(t="text-yellow-600",n=e.jsx(w,{className:"w-5 h-5"}))}return e.jsxs("div",{className:"min-h-dvh w-full p-4 md:p-8 lg:p-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(p,{to:"/matches",children:e.jsx(N,{variant:"ghost",children:"← Back to Matches"})}),b&&e.jsx(p,{to:`/matches/${d}`,children:e.jsx(N,{variant:"outline",children:"Edit Match"})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4",children:l.name||`Match ${l.round}M${l.match_number}`}),e.jsxs("div",{className:`flex items-center justify-center gap-2 text-xl font-medium ${t}`,children:[n,e.jsx("span",{children:c})]}),e.jsx("div",{className:"mt-4",children:e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full dark:bg-blue-900/30 dark:text-blue-200",children:"Upcoming Match"})})]}),e.jsx("div",{className:"text-center mb-8",children:e.jsx("div",{className:"text-6xl font-bold text-muted-foreground",children:"VS"})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-4 text-white px-4 py-1 rounded bg-red-600",children:i}),e.jsx("ul",{className:"grid gap-4",children:r.map((a,s)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[240px_1fr] items-center",children:[e.jsx(_,{team:a??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9}),e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",a.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:a.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})})]})},`r-${s}`))})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-4 text-white px-4 py-1 rounded bg-blue-600",children:o}),e.jsx("ul",{className:"grid gap-4",children:m.map((a,s)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[1fr_240px] items-center",children:[e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold text-right",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",a.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:a.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})}),e.jsx(_,{team:a??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9})]})},`b-${s}`))})]})]})]})}async function K(l){if(l.length===0)return{};const{data:d,error:r}=await y.from("alliances").select("id, name").in("id",l);if(r)throw r;const m={};return(d??[]).forEach(i=>m[i.id]=i.name),m}async function P(l){if(l.length===0)return[];const{data:d,error:r}=await y.from("alliance_teams").select("alliance_id, team_id, slot").in("alliance_id",l).order("slot",{ascending:!0});if(r)throw r;return d??[]}async function V(l){if(l.length===0)return[];const{data:d,error:r}=await y.from("teams").select("id, number, name, robot_image_url").in("id",l);if(r)throw r;return d??[]}function re(){const{user:l}=D(),{matchId:d}=T(),{data:r,isLoading:m,error:i}=C(d),o=f.useMemo(()=>r?[r.red_alliance_id,r.blue_alliance_id].filter(u=>u!==null):[],[r]),{data:b={},isLoading:c,error:n}=v({queryKey:["alliances","names",o.sort().join(",")],queryFn:()=>K(o),enabled:o.length>0}),{data:t=[],isLoading:a,error:s}=v({queryKey:["alliance_teams","byAlliances",o.sort().join(",")],queryFn:()=>P(o),enabled:o.length>0}),g=f.useMemo(()=>Array.from(new Set(t.map(u=>u.team_id))),[t]),{data:k=[],isLoading:B,error:R}=v({queryKey:["teams","byIds",g.sort().join(",")],queryFn:()=>V(g),enabled:g.length>0}),j=f.useMemo(()=>new Map(k.map(u=>[u.id,u])),[k]),M=f.useMemo(()=>{const u=[null,null,null,null];return t.filter(x=>x.alliance_id===r?.red_alliance_id).forEach(x=>{x.slot>=1&&x.slot<=4&&(u[x.slot-1]=j.get(x.team_id)??null)}),u},[t,j,r?.red_alliance_id]),A=f.useMemo(()=>{const u=[null,null,null,null];return t.filter(x=>x.alliance_id===r?.blue_alliance_id).forEach(x=>{x.slot>=1&&x.slot<=4&&(u[x.slot-1]=j.get(x.team_id)??null)}),u},[t,j,r?.blue_alliance_id]),U=m||c||a||B,$=i||n||s||R;if(!d)return e.jsx("p",{children:"Missing match id"});if(U)return e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading…"});if($)return e.jsxs("p",{className:"text-red-600",children:["Error: ",String($)]});if(!r)return e.jsx("p",{children:"Match not found"});const L=r.red_alliance_id?b[r.red_alliance_id]??"Red Alliance":"Red Alliance",S=r.blue_alliance_id?b[r.blue_alliance_id]??"Blue Alliance":"Blue Alliance";return r.red_score!==null&&r.blue_score!==null?e.jsx(q,{match:r,matchId:d,redSlots:M,blueSlots:A,redAllianceName:L,blueAllianceName:S,user:l}):e.jsx(W,{match:r,matchId:d,redSlots:M,blueSlots:A,redAllianceName:L,blueAllianceName:S,user:l})}export{re as default};
