import{j as e,r}from"./index-1lrkdZKD.js";import{s as d}from"./client-BsRRs-fS.js";import{c as N}from"./utils-CBfrqCZ4.js";function f({className:n,type:i,...o}){return e.jsx("input",{type:i,"data-slot":"input",className:N("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",n),...o})}const l=r.forwardRef(({className:n,...i},o)=>e.jsx("label",{ref:o,className:N("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",n),...i}));l.displayName="Label";function q(){const[n,i]=r.useState(""),[o,P]=r.useState(""),[x,a]=r.useState(null),[c,u]=r.useState(!1),[g,p]=r.useState(!1),[m,b]=r.useState(""),[y,v]=r.useState("");r.useEffect(()=>{async function t(){try{const s=new URL(window.location.href),h=s.searchParams.get("type"),j=s.searchParams.get("code");if(j){const{error:w}=await d.auth.exchangeCodeForSession(j);if(!w){p(!0),window.history.replaceState({},"",s.origin+s.pathname);return}}if(window.location.hash.includes("access_token")){const w=new URLSearchParams(window.location.hash.slice(1)),S=w.get("access_token")??void 0,k=w.get("refresh_token")??void 0;if(S&&k){const{error:U}=await d.auth.setSession({access_token:S,refresh_token:k});if(!U){p(!0),window.history.replaceState({},"",s.origin+s.pathname);return}}}h==="recovery"&&p(!0)}catch{}}t()},[]);async function C(t){t.preventDefault(),a(null),u(!0);try{const{error:s}=await d.auth.signInWithPassword({email:n,password:o});if(s)throw s;a("Signed in!")}catch(s){a(`Error: ${s?.message||"Unable to sign in."}`)}finally{u(!1)}}async function E(t){if(t.preventDefault(),a(null),!n){a("Enter your email first.");return}try{const s=`${window.location.origin}/noreaster/update-password`,{error:h}=await d.auth.resetPasswordForEmail(n,{redirectTo:s});if(h)throw h;a("Password reset link sent. Check your email.")}catch(s){a(`Error: ${s?.message||"Unable to send reset link."}`)}}async function R(t){if(t.preventDefault(),a(null),m.length<8){a("Password must be at least 8 characters.");return}if(m!==y){a("Passwords do not match.");return}u(!0);try{const{error:s}=await d.auth.updateUser({password:m});if(s)throw s;a("Password updated. You can now sign in."),p(!1),b(""),v("")}catch(s){a(`Error: ${s?.message||"Unable to update password."}`)}finally{u(!1)}}return e.jsxs("div",{className:"max-w-sm",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-4",children:g?"Reset password":"Sign in"}),g?e.jsxs("form",{onSubmit:R,className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(l,{children:"New password"}),e.jsx(f,{type:"password",required:!0,value:m,onChange:t=>b(t.target.value),autoComplete:"new-password"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(l,{children:"Confirm new password"}),e.jsx(f,{type:"password",required:!0,value:y,onChange:t=>v(t.target.value),autoComplete:"new-password"})]}),e.jsx("button",{disabled:c,type:"submit",className:"rounded-md bg-black text-white px-3 py-2 hover:opacity-90 disabled:opacity-60 dark:bg-white dark:text-black",children:c?"Saving...":"Update password"})]}):e.jsxs("form",{onSubmit:C,className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(l,{children:"Email"}),e.jsx(f,{type:"email",required:!0,value:n,onChange:t=>i(t.target.value),autoComplete:"username"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(l,{children:"Password"}),e.jsx(f,{type:"password",required:!0,value:o,onChange:t=>P(t.target.value),autoComplete:"current-password"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{disabled:c,type:"submit",className:"rounded-md bg-black text-white px-3 py-2 hover:opacity-90 disabled:opacity-60 dark:bg-white dark:text-black",children:c?"Signing in...":"Sign in"}),e.jsx("button",{type:"button",onClick:E,className:"text-sm underline opacity-90 hover:opacity-100",children:"Forgot password?"})]})]}),x&&e.jsx("p",{className:"mt-3 text-sm opacity-80",children:x}),!g&&e.jsxs("div",{className:"mt-6 text-sm text-muted-foreground space-y-2",children:[e.jsx("p",{children:"Sign-up is disabled. Ask an admin to create your account or change your password."}),e.jsx("p",{children:"Admins: In Supabase Dashboard → Authentication → Providers → Email, disable new signups. To change a user's password, open Authentication → Users → select user → Reset Password."})]})]})}export{q as default};
