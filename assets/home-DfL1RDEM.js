import{j as r,r as u,L as d,s as N}from"./index-BzX4-QBV.js";import{u as g}from"./useQuery-MXQqrAhs.js";import{M as p}from"./match-card-GiB-Dbma.js";import{B as _}from"./button-DR301_bp.js";import{c as f,R as y}from"./rankings-D1v5p-Gl.js";import{C as v,a as w,b as A,c as I}from"./card-kGRMENUq.js";function h({title:l,right:s,children:i,className:t}){return r.jsxs(v,{className:t,children:[r.jsxs(w,{className:"flex flex-row items-center justify-between",children:[r.jsx(A,{className:"text-lg font-semibold",children:l}),s]}),r.jsx(I,{children:i})]})}function T({title:l,actions:s,className:i}){return r.jsxs("div",{className:`flex items-center justify-between ${i??""}`,children:[r.jsx("h1",{className:"text-2xl font-semibold",children:l}),s]})}async function k(){const{data:l,error:s}=await N.from("alliances").select("id, name");if(s)throw s;return l??[]}async function E(){const{data:l,error:s}=await N.from("matches").select("id, name, red_alliance_id, blue_alliance_id, scheduled_at, red_score, blue_score, red_coral_rp, red_auto_rp, red_barge_rp, blue_coral_rp, blue_auto_rp, blue_barge_rp, red:alliances!matches_red_alliance_id_fkey(name), blue:alliances!matches_blue_alliance_id_fkey(name)");if(s)throw s;return l??[]}function V(){const{data:l=[]}=g({queryKey:["alliances","list"],queryFn:k}),{data:s=[],isLoading:i,error:t}=g({queryKey:["matches","home-all"],queryFn:E});function c(e){return l.find(a=>a.id===e)?.name??e}const j=u.useMemo(()=>f(l,s.map(e=>({red_alliance_id:e.red_alliance_id,blue_alliance_id:e.blue_alliance_id,red_score:e.red_score,blue_score:e.blue_score,red_coral_rp:!!e.red_coral_rp,red_auto_rp:!!e.red_auto_rp,red_barge_rp:!!e.red_barge_rp,blue_coral_rp:!!e.blue_coral_rp,blue_auto_rp:!!e.blue_auto_rp,blue_barge_rp:!!e.blue_barge_rp}))).slice(0,8),[l,s]),m=u.useMemo(()=>{const e=s.filter(a=>a.red_score==null&&a.blue_score==null);return e.sort((a,n)=>{const o=a.scheduled_at?new Date(a.scheduled_at).getTime():Number.NEGATIVE_INFINITY,b=n.scheduled_at?new Date(n.scheduled_at).getTime():Number.NEGATIVE_INFINITY;return o-b}),e.slice(0,10)},[s]),x=u.useMemo(()=>{const e=s.filter(a=>a.red_score!=null&&a.blue_score!=null);return e.sort((a,n)=>{const o=a.scheduled_at?new Date(a.scheduled_at).getTime():Number.NEGATIVE_INFINITY;return(n.scheduled_at?new Date(n.scheduled_at).getTime():Number.NEGATIVE_INFINITY)-o}),e.slice(0,5)},[s]);return r.jsxs("div",{className:"space-y-6",children:[r.jsx(T,{title:"Dashboard",actions:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(d,{to:"/matches",children:r.jsx(_,{variant:"outline",children:"Matches"})}),r.jsx(d,{to:"/rankings",children:r.jsx(_,{variant:"outline",children:"Rankings"})}),r.jsx(d,{to:"/schedule",children:r.jsx(_,{variant:"outline",children:"Schedule"})})]})}),r.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsxs(h,{title:"Upcoming Matches",right:r.jsx(d,{to:"/matches/preview",className:"text-sm underline",children:"Preview"}),children:[i&&r.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading…"}),t&&r.jsx("div",{className:"text-sm text-red-600",children:String(t)}),!i&&!t&&(m.length===0?r.jsx("div",{className:"text-sm text-muted-foreground",children:"No upcoming matches."}):r.jsx("ul",{className:"grid gap-2",children:m.map(e=>{const a=Array.isArray(e.red)?e.red[0]?.name??c(e.red_alliance_id):e.red?.name??c(e.red_alliance_id),n=Array.isArray(e.blue)?e.blue[0]?.name??c(e.blue_alliance_id):e.blue?.name??c(e.blue_alliance_id);return r.jsx("li",{children:r.jsx(p,{title:e.name??void 0,scheduledAt:e.scheduled_at,redName:a,blueName:n,redScore:e.red_score,blueScore:e.blue_score,showRelativeTime:!0,editHref:`/matches/${e.id}`})},e.id)})}))]}),r.jsx(h,{title:"Rankings (Top 8)",right:r.jsx(d,{to:"/rankings",className:"text-sm underline",children:"View all"}),children:r.jsxs("div",{className:"overflow-x-auto",children:[i&&r.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading…"}),t&&r.jsx("div",{className:"text-sm text-red-600",children:String(t)}),!i&&!t&&r.jsx(y,{rows:j,showRank:!0,size:"sm"})]})})]}),r.jsxs(h,{title:"Recent Matches",right:r.jsx(d,{to:"/matches",className:"text-sm underline",children:"View all"}),children:[i&&r.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading…"}),t&&r.jsx("div",{className:"text-sm text-red-600",children:String(t)}),!i&&!t&&(x.length===0?r.jsx("div",{className:"text-sm text-muted-foreground",children:"No completed matches."}):r.jsx("ul",{className:"grid gap-2",children:x.map(e=>{const a=Array.isArray(e.red)?e.red[0]?.name??c(e.red_alliance_id):e.red?.name??c(e.red_alliance_id),n=Array.isArray(e.blue)?e.blue[0]?.name??c(e.blue_alliance_id):e.blue?.name??c(e.blue_alliance_id);return r.jsx("li",{children:r.jsx(p,{title:e.name??void 0,scheduledAt:e.scheduled_at,redName:a,blueName:n,redScore:e.red_score,blueScore:e.blue_score,editHref:`/matches/${e.id}`})},e.id)})}))]})]})}export{V as default};
