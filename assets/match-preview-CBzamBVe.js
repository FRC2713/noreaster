import{b as B,r as d,j as e,L as v,s as h}from"./index-WvZcqDcg.js";import{u as x}from"./useQuery-DTQ6mRtF.js";import{R as y}from"./robot-image-flneOwZu.js";import{B as w}from"./button-BjoTGIGe.js";import{u as T}from"./use-match-Cp_XwAwQ.js";async function U(t){if(t.length===0)return{};const{data:s,error:r}=await h.from("alliances").select("id, name").in("id",t);if(r)throw r;const o={};return(s??[]).forEach(n=>o[n.id]=n.name),o}async function I(t){if(t.length===0)return[];const{data:s,error:r}=await h.from("alliance_teams").select("alliance_id, team_id, slot").in("alliance_id",t).order("slot",{ascending:!0});if(r)throw r;return s??[]}async function K(t){if(t.length===0)return[];const{data:s,error:r}=await h.from("teams").select("id, number, name, robot_image_url").in("id",t);if(r)throw r;return s??[]}function z(){const{matchId:t}=B(),{data:s,isLoading:r,error:o}=T(t),n=d.useMemo(()=>s?[s.red_alliance_id,s.blue_alliance_id]:[],[s]),{data:g={},isLoading:M,error:L}=x({queryKey:["alliances","names",n.sort().join(",")],queryFn:()=>U(n),enabled:n.length>0}),{data:i=[],isLoading:E,error:A}=x({queryKey:["alliance_teams","byAlliances",n.sort().join(",")],queryFn:()=>I(n),enabled:n.length>0}),m=d.useMemo(()=>Array.from(new Set(i.map(l=>l.team_id))),[i]),{data:f=[],isLoading:R,error:$}=x({queryKey:["teams","byIds",m.sort().join(",")],queryFn:()=>K(m),enabled:m.length>0}),c=d.useMemo(()=>new Map(f.map(l=>[l.id,l])),[f]),q=d.useMemo(()=>{const l=[null,null,null,null];return i.filter(a=>a.alliance_id===s?.red_alliance_id).forEach(a=>{a.slot>=1&&a.slot<=4&&(l[a.slot-1]=c.get(a.team_id)??null)}),l},[i,c,s?.red_alliance_id]),S=d.useMemo(()=>{const l=[null,null,null,null];return i.filter(a=>a.alliance_id===s?.blue_alliance_id).forEach(a=>{a.slot>=1&&a.slot<=4&&(l[a.slot-1]=c.get(a.team_id)??null)}),l},[i,c,s?.blue_alliance_id]),F=r||M||E||R,b=o||L||A||$;if(!t)return e.jsx("p",{children:"Missing match id"});if(F)return e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading…"});if(b)return e.jsxs("p",{className:"text-red-600",children:["Error: ",String(b)]});if(!s)return e.jsx("p",{children:"Match not found"});const _=g[s.red_alliance_id]??"Red Alliance",j=g[s.blue_alliance_id]??"Blue Alliance",u=s.red_score!==null&&s.blue_score!==null,p=u&&s.red_score>s.blue_score,N=u&&s.blue_score>s.red_score;return e.jsxs("div",{className:"min-h-dvh w-full p-4 md:p-8 lg:p-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(v,{to:"/matches",children:e.jsx(w,{variant:"ghost",children:"← Back to Matches"})}),e.jsx(v,{to:`/matches/${t}`,children:e.jsx(w,{variant:"outline",children:"Edit Match"})})]}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-2xl md:text-3xl opacity-70",children:s.round&&s.match_number?`Round ${s.round} Match ${s.match_number}`:"Match Preview"}),e.jsxs("div",{className:"text-3xl md:text-5xl font-bold",children:[_," vs ",j]}),s.scheduled_at&&e.jsx("div",{className:"text-lg md:text-2xl opacity-70 mt-2",children:new Date(s.scheduled_at).toLocaleString()}),u&&e.jsxs("div",{className:"text-2xl md:text-3xl font-bold mt-4",children:[e.jsx("span",{className:p?"text-yellow-400":"",children:s.red_score}),e.jsx("span",{className:"mx-4",children:"-"}),e.jsx("span",{className:N?"text-yellow-400":"",children:s.blue_score})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-3xl md:text-4xl font-bold mb-4 text-white px-4 py-1 rounded ${p?"bg-red-600 ring-2 ring-yellow-400":"bg-red-600"}`,children:_}),e.jsx("ul",{className:"grid gap-4",children:q.map((l,a)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[240px_1fr] items-center",children:[e.jsx(y,{team:l??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9}),e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",l.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:l.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})})]})},`r-${a}`))})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-3xl md:text-4xl font-bold mb-4 text-white px-4 py-1 rounded ${N?"bg-blue-600 ring-2 ring-yellow-400":"bg-blue-600"}`,children:j}),e.jsx("ul",{className:"grid gap-4",children:S.map((l,a)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[1fr_240px] items-center",children:[e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold text-right",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",l.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:l.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})}),e.jsx(y,{team:l??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9})]})},`b-${a}`))})]})]})]})}export{z as default};
