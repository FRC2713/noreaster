import{c as l}from"./query-vendor-DjGQMdFW.js";import{s}from"./index-Ecy2JF11.js";async function A(){const{data:t,error:a}=await s.from("alliances").select("id, name, created_at, emblem_image_url").order("created_at",{ascending:!0});if(a)throw a;return t||[]}async function T(){const{data:t,error:a}=await s.from("teams").select("id, number, name, robot_image_url");if(a)throw a;return t||[]}async function L(){const{data:t,error:a}=await s.from("alliance_teams").select("id, alliance_id, team_id, slot");if(a)throw a;return t||[]}function v(){const{data:t=[],isLoading:a,error:d,dataUpdatedAt:m}=l({queryKey:["alliances","polling"],queryFn:A,refetchInterval:1e4,refetchIntervalInBackground:!0,staleTime:0,gcTime:3e5}),{data:i=[],isLoading:u,error:f}=l({queryKey:["teams","polling"],queryFn:T,refetchInterval:1e4,refetchIntervalInBackground:!0,staleTime:0,gcTime:300*1e3}),{data:g=[],isLoading:_,error:p,dataUpdatedAt:h}=l({queryKey:["alliance_teams","polling"],queryFn:L,refetchInterval:1e4,refetchIntervalInBackground:!0,staleTime:0,gcTime:300*1e3}),r=t.map(e=>({id:e.id,name:e.name,created_at:e.created_at,emblem_image_url:e.emblem_image_url,teams:[null,null,null,null]})),y=new Map(i.map(e=>[e.id,e]));g.forEach(e=>{const c=r.findIndex(w=>w.id===e.alliance_id);c!==-1&&e.slot>=1&&e.slot<=4&&(r[c].teams[e.slot-1]=y.get(e.team_id)??null)});const I=a||u||_,n=d||f||p,o=Math.max(m||0,h||0);return{alliances:r,teams:i,isLoading:I,error:n?n instanceof Error?n.message:"Failed to fetch alliances data":null,lastUpdated:o?new Date(o):null}}export{v as u};
