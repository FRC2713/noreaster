import{r as b}from"./react-vendor-BE_oCUfB.js";import{u as m}from"./use-alliances-polling-CtHLpTf5.js";import{u as S}from"./use-matches-polling-Sgiz89dp.js";function f(n,_){if(!n.length)return[];const i=new Map;n.forEach(e=>{i.set(e.id,{id:e.id,name:e.name,emblem_image_url:e.emblem_image_url,played:0,wins:0,losses:0,ties:0,totalRp:0,totalScore:0,countedScoreMatches:0,totalAutoScore:0,countedAutoScoreMatches:0})});const c=(e,o)=>{const r=i.get(e);r&&(r.totalRp+=o)};for(const e of _){if(!e.red_alliance_id||!e.blue_alliance_id)continue;const o=i.get(e.red_alliance_id),r=i.get(e.blue_alliance_id);!o||!r||!(e.red_score!=null&&e.blue_score!=null)||(o.played+=1,r.played+=1,e.red_score>e.blue_score?(o.wins+=1,r.losses+=1,c(o.id,3)):e.red_score<e.blue_score?(r.wins+=1,o.losses+=1,c(r.id,3)):(o.ties+=1,r.ties+=1,c(o.id,1),c(r.id,1)),c(o.id,(e.red_coral_rp?1:0)+(e.red_auto_rp?1:0)+(e.red_barge_rp?1:0)),c(r.id,(e.blue_coral_rp?1:0)+(e.blue_auto_rp?1:0)+(e.blue_barge_rp?1:0)),o.totalScore+=e.red_score,o.countedScoreMatches+=1,r.totalScore+=e.blue_score,r.countedScoreMatches+=1,o.totalAutoScore+=e.red_auto_score??0,o.countedAutoScoreMatches+=1,r.totalAutoScore+=e.blue_auto_score??0,r.countedAutoScoreMatches+=1)}const s=Array.from(i.values()).map(e=>{const o=e.played>0?e.totalRp/e.played:0,r=e.countedScoreMatches>0?e.totalScore/e.countedScoreMatches:0,l=e.countedAutoScoreMatches>0?e.totalAutoScore/e.countedAutoScoreMatches:0;return{...e,avgRp:o,avgScore:r,avgAutoScore:l}});function u(e,o){let r=0,l=0;for(const a of _)(a.red_alliance_id===e||a.blue_alliance_id===e)&&(a.red_alliance_id===o||a.blue_alliance_id===o)&&(a.red_score==null||a.blue_score==null||(a.red_score>a.blue_score?a.red_alliance_id===e?r++:a.red_alliance_id===o&&l++:a.blue_score>a.red_score&&(a.blue_alliance_id===e?r++:a.blue_alliance_id===o&&l++)));return{aWins:r,bWins:l}}return s.sort((e,o)=>{if(o.avgRp!==e.avgRp)return o.avgRp-e.avgRp;const{aWins:r,bWins:l}=u(e.id,o.id);return r!==l?l-r:o.avgScore!==e.avgScore?o.avgScore-e.avgScore:o.avgAutoScore!==e.avgAutoScore?o.avgAutoScore-e.avgAutoScore:e.name.localeCompare(o.name)}),s.map((e,o)=>({id:e.id,name:e.name,emblem_image_url:e.emblem_image_url,played:e.played,wins:e.wins,losses:e.losses,ties:e.ties,avgRp:e.avgRp,avgScore:e.avgScore,avgAutoScore:e.avgAutoScore,rank:o+1}))}function A(){const{matches:n,isLoading:_,error:i,lastUpdated:c}=S(),{alliances:s,isLoading:u,error:e,lastUpdated:o}=m(),r=b.useMemo(()=>{const p=s.map(t=>({id:t.id,name:t.name,emblem_image_url:t.emblem_image_url})),g=n.map(t=>({red_alliance_id:t.red_alliance_id,blue_alliance_id:t.blue_alliance_id,red_score:t.red_score,blue_score:t.blue_score,red_auto_score:t.red_auto_score,blue_auto_score:t.blue_auto_score,red_coral_rp:t.red_coral_rp,red_auto_rp:t.red_auto_rp,red_barge_rp:t.red_barge_rp,blue_coral_rp:t.blue_coral_rp,blue_auto_rp:t.blue_auto_rp,blue_barge_rp:t.blue_barge_rp}));return f(p,g)},[s,n]),l=_||u,a=i||e,d=c&&o?new Date(Math.max(c.getTime(),o.getTime())):c||o;return{rankings:r,isLoading:l,error:a,lastUpdated:d}}export{A as u};
