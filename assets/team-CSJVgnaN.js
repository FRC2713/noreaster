import{b as U,a as P,r as n,j as e,L as Q,s as u}from"./index-BbsRpNjG.js";import{u as k}from"./useQuery-CDvurSQj.js";import{u as A}from"./useMutation-Ce0TQO7E.js";import{B}from"./button-DzpIyQ-0.js";import{C as K,c as M}from"./card-BqxiuqNF.js";import{L as c,I as _}from"./label-CisLujVD.js";import{R as $}from"./robot-image-lizaRGwK.js";function D(f=8){const s=new Uint8Array(f);return crypto.getRandomValues(s),Array.from(s,m=>m.toString(16).padStart(2,"0")).join("")}function X(){const s=U().teamId,m=P(),{data:a,isLoading:C,error:T}=k({queryKey:["teams","detail",s],queryFn:async()=>{const{data:t,error:r}=await u.from("teams").select("id, number, name, robot_image_url").eq("id",s).single();if(r)throw r;return t}}),[p,g]=n.useState(""),[d,b]=n.useState(""),[i,x]=n.useState(null),[h,o]=n.useState(null),[j,N]=n.useState(!1);n.useEffect(()=>{a&&(g(String(a.number??"")),b(a.name??""))},[a]);const E=n.useMemo(()=>i?URL.createObjectURL(i):a?.robot_image_url??null,[i,a]),q=A({mutationFn:async t=>{const{number:r,name:F,file:l}=t;let v=a?.robot_image_url??null;if(l){const I=(l.name.split(".").pop()||"png").toLowerCase(),S=`images/${Date.now()}_${D(6)}.${I}`,{error:w}=await u.storage.from("robots").upload(S,l,{cacheControl:"3600",upsert:!1,contentType:l.type});if(w)throw w;const{data:R}=u.storage.from("robots").getPublicUrl(S);v=R.publicUrl}const{error:y}=await u.from("teams").update({number:r,name:F,robot_image_url:v}).eq("id",s);if(y)throw y},onSuccess:()=>{m.invalidateQueries({queryKey:["teams","list"]}),m.invalidateQueries({queryKey:["teams","detail",s]}),o("Saved."),x(null)},onError:t=>{const r=t instanceof Error?t.message:"Failed to save";o(r)},onSettled:()=>N(!1)});async function L(t){t.preventDefault(),o(null);const r=Number(p);if(!r||r<=0){o("Enter a valid team number.");return}if(!d.trim()){o("Enter a team name.");return}N(!0),q.mutate({number:r,name:d.trim(),file:i})}return C?e.jsx("p",{children:"Loading team..."}):T||!a?e.jsx("p",{className:"text-red-600",children:"Team not found."}):e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Edit Team"}),e.jsx(Q,{to:"/teams",className:"text-sm hover:underline",children:"Back to Teams"})]}),e.jsx(K,{children:e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-[280px_1fr]",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"rounded-md overflow-hidden border bg-muted",children:i?e.jsx("img",{src:E??void 0,alt:"Team robot",className:"w-full h-48 object-cover"}):a?.robot_image_url?e.jsx($,{team:{id:a.id,number:a.number,name:a.name,robot_image_url:a.robot_image_url},className:"w-full h-48",ratio:16/9}):e.jsx("div",{className:"w-full h-48 grid place-items-center text-muted-foreground",children:"No image"})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{className:"text-sm font-medium",htmlFor:"robot-file",children:"Team Picture"}),e.jsx("input",{id:"robot-file",type:"file",accept:"image/*",onChange:t=>x(t.target.files?.[0]??null),className:"w-full rounded-md border px-3 py-2 file:mr-3 file:rounded-md file:border file:px-3 file:py-1.5 file:bg-background"})]})]}),e.jsxs("form",{onSubmit:L,className:"grid gap-4 content-start",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"team-number",className:"text-sm font-medium",children:"Team Number"}),e.jsx(_,{id:"team-number",type:"number",min:1,required:!0,value:p,onChange:t=>g(t.target.value),placeholder:"e.g. 6328"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"team-name",className:"text-sm font-medium",children:"Team Name"}),e.jsx(_,{id:"team-name",type:"text",required:!0,value:d,onChange:t=>b(t.target.value),placeholder:"Mechanical Advantage"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{type:"submit",disabled:j,children:j?"Saving...":"Save"}),h&&e.jsx("span",{className:"text-sm opacity-80",children:h})]})]})]})})})]})}export{X as default};
