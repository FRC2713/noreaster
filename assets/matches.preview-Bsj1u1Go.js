import{j as e}from"./ui-vendor-CWhAcX5I.js";import{r as f}from"./react-vendor-BE_oCUfB.js";import{c as p}from"./query-vendor-Cs1Z885O.js";import{s as j}from"./index-DDBma67i.js";import{R as v}from"./robot-image-BalY4Rkk.js";import{u as $}from"./use-matches-polling-BD-JXtZx.js";import"./supabase-vendor-BfNnX3KH.js";import"./utils-vendor-Dkv1a4Vh.js";import"./icons-vendor-NdmwdHec.js";function k(r,c){const n=c.filter(a=>(a.red_alliance_id===r||a.blue_alliance_id===r)&&a.red_score!==null&&a.blue_score!==null);let d=0,t=0,m=0,o=0,b=0,g=0,i=0;for(const a of n){const h=a.red_alliance_id===r,u=h?a.red_score:a.blue_score,x=h?a.blue_score:a.red_score;o+=u,b+=x,g+=h?(a.red_coral_rp?1:0)+(a.red_auto_rp?1:0)+(a.red_barge_rp?1:0):(a.blue_coral_rp?1:0)+(a.blue_auto_rp?1:0)+(a.blue_barge_rp?1:0),i++,u>x?d++:u<x?t++:m++}return{wins:d,losses:t,ties:m,avgScore:i>0?o/i:0,avgOpponentScore:i>0?b/i:0,rankingPointAverage:i>0?g/i:0}}function w({allianceId:r,matches:c,color:n,className:d=""}){const t=f.useMemo(()=>k(r,c),[r,c]),o={red:{bg:"bg-red-600/20",border:"border-red-500/30",text:"text-red-200"},blue:{bg:"bg-blue-600/20",border:"border-blue-500/30",text:"text-blue-200"}}[n];return e.jsx("div",{className:`${o.bg} backdrop-blur-sm rounded-lg p-4 border ${o.border} ${d}`,children:e.jsxs("div",{className:"text-white space-y-2",children:[e.jsxs("div",{className:"text-2xl font-bold text-center flex flex-row justify-center items-baseline gap-2",children:[t.wins,"-",t.losses,"-",t.ties,e.jsxs("span",{className:`text-lg font-normal ${o.text}`,children:["(",t.rankingPointAverage.toFixed(2),")"]})]}),e.jsxs("div",{className:"flex flex-row justify-center items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col justify-center items-center",children:[e.jsx("div",{className:`text-sm ${o.text} text-center`,children:"Avg Score"}),e.jsx("div",{className:`text-lg ${o.text} text-center`,children:t.avgScore.toFixed(1)})]}),e.jsxs("div",{className:"flex flex-col justify-center items-center",children:[e.jsx("div",{className:`text-sm ${o.text} text-center`,children:"Avg Opp Score"}),e.jsx("div",{className:`text-lg ${o.text} text-center`,children:t.avgOpponentScore.toFixed(1)})]})]})]})})}async function F(r){if(r.length===0)return{};const{data:c,error:n}=await j.from("alliances").select("id, name").in("id",r);if(n)throw n;const d={};return(c??[]).forEach(t=>{d[t.id]=t.name}),d}async function I(r){if(r.length===0)return[];const{data:c,error:n}=await j.from("alliance_teams").select("id, alliance_id, team_id, slot").in("alliance_id",r);if(n)throw n;return c??[]}async function R(r){if(r.length===0)return[];const{data:c,error:n}=await j.from("teams").select("id, number, name, robot_image_url").in("id",r);if(n)throw n;return c??[]}function Y(){const{matches:r,isLoading:c,error:n}=$(),d=r.filter(l=>l.red_score==null&&l.blue_score==null);d.sort((l,s)=>{const L=l.scheduled_at?new Date(l.scheduled_at).getTime():Number.NEGATIVE_INFINITY,T=s.scheduled_at?new Date(s.scheduled_at).getTime():Number.NEGATIVE_INFINITY;return L-T});const t=d.length>0?d[0]:null,m=f.useMemo(()=>t?[t.red_alliance_id,t.blue_alliance_id]:[],[t]),{data:o={},isLoading:b,error:g}=p({queryKey:["alliances","names",m.sort().join(",")],queryFn:()=>F(m),enabled:m.length>0}),{data:i=[],isLoading:a,error:h}=p({queryKey:["alliance_teams","byAlliances",m.sort().join(",")],queryFn:()=>I(m),enabled:m.length>0}),u=f.useMemo(()=>Array.from(new Set(i.map(l=>l.team_id))),[i]),{data:x=[],isLoading:y,error:S}=p({queryKey:["teams","byIds",u.sort().join(",")],queryFn:()=>R(u),enabled:u.length>0}),_=f.useMemo(()=>new Map(x.map(l=>[l.id,l])),[x]),A=f.useMemo(()=>{const l=[null,null,null,null];return i.filter(s=>s.alliance_id===t?.red_alliance_id).forEach(s=>{s.slot>=1&&s.slot<=4&&(l[s.slot-1]=_.get(s.team_id)??null)}),l},[i,_,t?.red_alliance_id]),E=f.useMemo(()=>{const l=[null,null,null,null];return i.filter(s=>s.alliance_id===t?.blue_alliance_id).forEach(s=>{s.slot>=1&&s.slot<=4&&(l[s.slot-1]=_.get(s.team_id)??null)}),l},[i,_,t?.blue_alliance_id]),M=c||b||a||y,N=n||g||h||S;return M?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loadingâ€¦"}):N?e.jsxs("p",{className:"text-red-600",children:["Error: ",String(N)]}):t?e.jsx("div",{className:"w-full h-full bg-green-500 flex flex-col justify-end",children:e.jsx("div",{className:"border-t-2 border-white/20 w-full",children:e.jsxs("div",{className:"flex w-full",children:[e.jsxs("div",{className:"flex-1 bg-red-600 flex items-center justify-between px-8 py-4",children:[e.jsx("div",{className:"flex-shrink-0",children:t&&e.jsx(w,{allianceId:t.red_alliance_id,matches:r,color:"red"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-6 text-white",children:o[t.red_alliance_id]??"Red Alliance"}),e.jsx("div",{className:"flex justify-center gap-4",children:A.map((l,s)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-24 h-24 md:w-32 md:h-32 flex-shrink-0 mx-auto mb-2",children:e.jsx(v,{team:l??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full h-full bg-muted rounded-lg",ratio:1})}),l&&e.jsx("div",{className:"text-lg md:text-xl font-semibold text-white drop-shadow-lg",children:l.number})]},`r-${s}`))})]})]}),e.jsxs("div",{className:"flex-1 bg-blue-600 flex items-center justify-between px-8 py-4",children:[e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-6 text-white",children:o[t.blue_alliance_id]??"Blue Alliance"}),e.jsx("div",{className:"flex justify-center gap-4",children:E.map((l,s)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-24 h-24 md:w-32 md:h-32 flex-shrink-0 mx-auto mb-2",children:e.jsx(v,{team:l??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full h-full bg-muted rounded-lg",ratio:1})}),l&&e.jsx("div",{className:"text-lg md:text-xl font-semibold text-white drop-shadow-lg",children:l.number})]},`b-${s}`))})]}),e.jsx("div",{className:"flex-shrink-0",children:t&&e.jsx(w,{allianceId:t.blue_alliance_id,matches:r,color:"blue"})})]})]})})}):e.jsx("p",{className:"text-muted-foreground",children:"No unplayed matches."})}export{Y as default};
