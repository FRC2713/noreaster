import{r as o,j as e}from"./index-1lrkdZKD.js";import{u as m}from"./useQuery-BmSwP_wb.js";import{s as u}from"./client-BsRRs-fS.js";import{R as f}from"./robot-image-ly0dP-Nd.js";import"./index-E4NFLHVM.js";import"./index-B2pa_DWj.js";async function E(){const{data:l,error:r}=await u.from("matches").select("id, red_alliance_id, blue_alliance_id, scheduled_at, red_score, blue_score").is("red_score",null).is("blue_score",null).order("scheduled_at",{ascending:!0,nullsFirst:!0}).limit(1);if(r)throw r;return(l&&l[0])??null}async function q(l){if(l.length===0)return{};const{data:r,error:n}=await u.from("alliances").select("id, name").in("id",l);if(n)throw n;const s={};return(r??[]).forEach(i=>s[i.id]=i.name),s}async function A(l){if(l.length===0)return[];const{data:r,error:n}=await u.from("alliance_teams").select("alliance_id, team_id, slot").in("alliance_id",l).order("slot",{ascending:!0});if(n)throw n;return r??[]}async function M(l){if(l.length===0)return[];const{data:r,error:n}=await u.from("teams").select("id, number, name, robot_image_url").in("id",l);if(n)throw n;return r??[]}function k(){const{data:l,isLoading:r,error:n}=m({queryKey:["matches","next-unplayed"],queryFn:E}),s=o.useMemo(()=>l?[l.red_alliance_id,l.blue_alliance_id]:[],[l]),{data:i={},isLoading:_,error:b}=m({queryKey:["alliances","names",s.sort().join(",")],queryFn:()=>q(s),enabled:s.length>0}),{data:d=[],isLoading:p,error:j}=m({queryKey:["alliance_teams","byAlliances",s.sort().join(",")],queryFn:()=>A(s),enabled:s.length>0}),x=o.useMemo(()=>Array.from(new Set(d.map(a=>a.team_id))),[d]),{data:h=[],isLoading:N,error:y}=m({queryKey:["teams","byIds",x.sort().join(",")],queryFn:()=>M(x),enabled:x.length>0}),c=o.useMemo(()=>new Map(h.map(a=>[a.id,a])),[h]),v=o.useMemo(()=>{const a=[null,null,null,null];return d.filter(t=>t.alliance_id===l?.red_alliance_id).forEach(t=>{t.slot>=1&&t.slot<=4&&(a[t.slot-1]=c.get(t.team_id)??null)}),a},[d,c,l?.red_alliance_id]),w=o.useMemo(()=>{const a=[null,null,null,null];return d.filter(t=>t.alliance_id===l?.blue_alliance_id).forEach(t=>{t.slot>=1&&t.slot<=4&&(a[t.slot-1]=c.get(t.team_id)??null)}),a},[d,c,l?.blue_alliance_id]),L=r||_||p||N,g=n||b||j||y;return L?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loadingâ€¦"}):g?e.jsxs("p",{className:"text-red-600",children:["Error: ",String(g)]}):l?e.jsxs("div",{className:"min-h-dvh w-full p-4 md:p-8 lg:p-10",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-2xl md:text-3xl opacity-70",children:"Up Next"}),e.jsxs("div",{className:"text-3xl md:text-5xl font-bold",children:[i[l.red_alliance_id]??"Red Alliance"," vs ",i[l.blue_alliance_id]??"Blue Alliance"]}),l.scheduled_at&&e.jsx("div",{className:"text-lg md:text-2xl opacity-70 mt-2",children:new Date(l.scheduled_at).toLocaleTimeString()})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-4 text-white bg-red-600 inline-block px-4 py-1 rounded",children:i[l.red_alliance_id]??"Red Alliance"}),e.jsx("ul",{className:"grid gap-4",children:v.map((a,t)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[240px_1fr] items-center",children:[e.jsx(f,{team:a??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9}),e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",a.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:a.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})})]})},`r-${t}`))})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-4 text-white bg-blue-600 inline-block px-4 py-1 rounded",children:i[l.blue_alliance_id]??"Blue Alliance"}),e.jsx("ul",{className:"grid gap-4",children:w.map((a,t)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[1fr_240px] items-center",children:[e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold text-right",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",a.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:a.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})}),e.jsx(f,{team:a??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9})]})},`b-${t}`))})]})]})]}):e.jsx("p",{className:"text-muted-foreground",children:"No unplayed matches."})}export{k as default};
