import{r as l,a as C,j as e,s as m}from"./index-WvZcqDcg.js";import{B as T}from"./button-BjoTGIGe.js";import{u as I}from"./useMutation-CLm6HZOQ.js";function R(o=8){const a=new Uint8Array(o);return crypto.getRandomValues(a),Array.from(a,s=>s.toString(16).padStart(2,"0")).join("")}function $(){const[o,a]=l.useState(""),[s,u]=l.useState(""),[y,d]=l.useState(null),[c,r]=l.useState(null),[p,f]=l.useState(!1),N=C(),j=I({mutationFn:async t=>{const{number:n,name:v,file:i}=t;let b=null;if(i){const w=(i.name.split(".").pop()||"png").toLowerCase(),g=`images/${Date.now()}_${R(6)}.${w}`,{error:h}=await m.storage.from("robots").upload(g,i,{cacheControl:"3600",upsert:!1,contentType:i.type});if(h)throw h;const{data:E}=m.storage.from("robots").getPublicUrl(g);b=E.publicUrl}const{error:x}=await m.from("teams").insert({number:n,name:v,robot_image_url:b});if(x)throw x},onSuccess:()=>{N.invalidateQueries({queryKey:["teams","list"]}),r("Team created!"),a(""),u(""),d(null),document.getElementById("robot-file")?.value&&(document.getElementById("robot-file").value="")},onError:t=>{r(`Error: ${t?.message||"Failed to create team."}`)},onSettled:()=>f(!1)});async function S(t){t.preventDefault(),r(null);const n=Number(o);if(!n||n<=0){r("Enter a valid team number.");return}if(!s.trim()){r("Enter a team name.");return}f(!0),j.mutate({number:n,name:s.trim(),file:y})}return e.jsxs("div",{className:"max-w-xl",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"Create Team"}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Team Number"}),e.jsx("input",{type:"number",min:1,required:!0,value:o,onChange:t=>a(t.target.value),className:"w-full rounded-md border px-3 py-2 outline-hidden",placeholder:"e.g. 6328"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Team Name"}),e.jsx("input",{type:"text",required:!0,value:s,onChange:t=>u(t.target.value),className:"w-full rounded-md border px-3 py-2 outline-hidden",placeholder:"Mechanical Advantage"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Robot Image (optional)"}),e.jsx("input",{id:"robot-file",type:"file",accept:"image/*",onChange:t=>d(t.target.files?.[0]??null),className:"w-full rounded-md border px-3 py-2 file:mr-3 file:rounded-md file:border file:px-3 file:py-1.5 file:bg-background"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{disabled:p,type:"submit",children:p?"Saving...":"Create Team"}),c&&e.jsx("span",{className:"text-sm opacity-80",children:c})]})]}),e.jsxs("p",{className:"mt-6 text-sm text-muted-foreground",children:["Note: Ensure a Supabase Storage bucket named ",e.jsx("strong",{children:"robots"})," exists and is public, and that the",e.jsx("strong",{children:" teams"})," table has appropriate RLS policies for inserts."]})]})}export{$ as default};
