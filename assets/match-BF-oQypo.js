import{r as a,h as L,f as O,j as e,d as D,P as F,i as W,v as X,t as M,b as G,a as J,L as V,s as N}from"./index-BzX4-QBV.js";import{u as q}from"./useQuery-MXQqrAhs.js";import{u as Y}from"./useMutation-DZjM51P6.js";import{B as I}from"./button-DR301_bp.js";function Z(t){const s=a.useRef({value:t,previous:t});return a.useMemo(()=>(s.current.value!==t&&(s.current.previous=s.current.value,s.current.value=t),s.current.previous),[t])}var k="Switch",[ee,ue]=D(k),[te,re]=ee(k),H=a.forwardRef((t,s)=>{const{__scopeSwitch:n,name:r,checked:o,defaultChecked:h,required:c,disabled:l,value:d="on",onCheckedChange:g,form:u,...x}=t,[p,m]=a.useState(null),_=L(s,b=>m(b)),v=a.useRef(!1),j=p?u||!!p.closest("form"):!0,[f,y]=O({prop:o,defaultProp:h??!1,onChange:g,caller:k});return e.jsxs(te,{scope:n,checked:f,disabled:l,children:[e.jsx(F.button,{type:"button",role:"switch","aria-checked":f,"aria-required":c,"data-state":$(f),"data-disabled":l?"":void 0,disabled:l,value:d,...x,ref:_,onClick:W(t.onClick,b=>{y(S=>!S),j&&(v.current=b.isPropagationStopped(),v.current||b.stopPropagation())})}),j&&e.jsx(U,{control:p,bubbles:!v.current,name:r,value:d,checked:f,required:c,disabled:l,form:u,style:{transform:"translateX(-100%)"}})]})});H.displayName=k;var K="SwitchThumb",Q=a.forwardRef((t,s)=>{const{__scopeSwitch:n,...r}=t,o=re(K,n);return e.jsx(F.span,{"data-state":$(o.checked),"data-disabled":o.disabled?"":void 0,...r,ref:s})});Q.displayName=K;var se="SwitchBubbleInput",U=a.forwardRef(({__scopeSwitch:t,control:s,checked:n,bubbles:r=!0,...o},h)=>{const c=a.useRef(null),l=L(c,h),d=Z(n),g=X(s);return a.useEffect(()=>{const u=c.current;if(!u)return;const x=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(x,"checked").set;if(d!==n&&m){const _=new Event("click",{bubbles:r});m.call(u,n),u.dispatchEvent(_)}},[d,n,r]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...o,tabIndex:-1,ref:l,style:{...o.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});U.displayName=se;function $(t){return t?"checked":"unchecked"}var z=H,ae=Q;const w=a.forwardRef(({className:t,...s},n)=>e.jsx(z,{ref:n,className:M("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,children:e.jsx(ae,{className:M("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));w.displayName=z.displayName;function T({title:t,coral:s,auto:n,barge:r,onCoralChange:o,onAutoChange:h,onBargeChange:c,className:l}){return e.jsxs("div",{className:`${l??""} border rounded-md p-4`,children:[e.jsx("div",{className:"font-semibold mb-3 text-lg",children:t}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Coral RP"}),e.jsx(w,{checked:s,onCheckedChange:o})]}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Auto RP"}),e.jsx(w,{checked:n,onCheckedChange:h})]}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Barge RP"}),e.jsx(w,{checked:r,onCheckedChange:c})]})]})}async function ne(t){const{data:s,error:n}=await N.from("matches").select("id, name, red_alliance_id, blue_alliance_id, scheduled_at, red_score, blue_score, red_coral_rp, red_auto_rp, red_barge_rp, blue_coral_rp, blue_auto_rp, blue_barge_rp").eq("id",t).single();if(n)throw n;return s??null}async function oe(){const{data:t,error:s}=await N.from("alliances").select("id, name");if(s)throw s;return t??[]}function he(){const{matchId:t}=G(),s=J(),{data:n=[]}=q({queryKey:["alliances","list"],queryFn:oe}),{data:r,isLoading:o,error:h}=q({queryKey:["matches","byId",t],queryFn:async()=>ne(t),enabled:!!t}),[c,l]=a.useState(""),[d,g]=a.useState(""),[u,x]=a.useState(!1),[p,m]=a.useState(!1),[_,v]=a.useState(!1),[j,f]=a.useState(!1),[y,b]=a.useState(!1),[S,R]=a.useState(!1),[B,P]=a.useState(null);a.useEffect(()=>{r&&(l(r.red_score!=null?String(r.red_score):""),g(r.blue_score!=null?String(r.blue_score):""),x(!!r.red_coral_rp),m(!!r.red_auto_rp),v(!!r.red_barge_rp),f(!!r.blue_coral_rp),b(!!r.blue_auto_rp),R(!!r.blue_barge_rp))},[r]);const E=Y({mutationFn:async()=>{if(!t)return;const i={red_score:c?Number(c):null,blue_score:d?Number(d):null,red_coral_rp:u,red_auto_rp:p,red_barge_rp:_,blue_coral_rp:j,blue_auto_rp:y,blue_barge_rp:S},{error:C}=await N.from("matches").update(i).eq("id",t);if(C)throw C},onSuccess:()=>{P("Saved."),s.invalidateQueries({queryKey:["matches","list"]}),s.invalidateQueries({queryKey:["matches","byId",t]})},onError:i=>P(`Save failed: ${i?.message??"Unknown error"}`)});function A(i){return n.find(C=>C.id===i)?.name??i}return t?o?e.jsx("p",{children:"Loading match…"}):h?e.jsxs("p",{className:"text-red-600",children:["Error: ",String(h)]}):r?e.jsxs("div",{className:"space-y-6 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{to:"/matches",children:e.jsx(I,{variant:"ghost",children:"← Back"})}),e.jsx("h1",{className:"text-2xl font-semibold",children:r.name??"Edit Match"})]}),e.jsxs("div",{className:"rounded-md border p-4",children:[e.jsxs("div",{className:"mb-4 font-semibold text-xl",children:[A(r.red_alliance_id)," vs ",A(r.blue_alliance_id)]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 text-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Red Score"}),e.jsx("input",{type:"number",value:c,onChange:i=>l(i.target.value),className:"w-full rounded-md border px-3 py-3 text-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Blue Score"}),e.jsx("input",{type:"number",value:d,onChange:i=>g(i.target.value),className:"w-full rounded-md border px-3 py-3 text-lg"})]})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsx(T,{title:"Red Alliance RP",coral:u,auto:p,barge:_,onCoralChange:x,onAutoChange:m,onBargeChange:v}),e.jsx(T,{title:"Blue Alliance RP",coral:j,auto:y,barge:S,onCoralChange:f,onAutoChange:b,onBargeChange:R})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{onClick:()=>E.mutate(),disabled:E.isPending,children:"Save"}),B&&e.jsx("span",{className:"text-sm opacity-80",children:B})]})]}):e.jsx("p",{children:"Match not found"}):e.jsx("p",{children:"Missing match id"})}export{he as default};
