import{c as W,b as ee,a as se,r as i,j as e,L as D,s as g}from"./index-WvZcqDcg.js";import{u as $}from"./useQuery-DTQ6mRtF.js";import{u as te}from"./useMutation-CLm6HZOQ.js";import{B as A}from"./button-BjoTGIGe.js";import{C as N,a as b,b as v,c as y}from"./card-Dnt-Pamn.js";import{L as T,I as B}from"./label-Ceiiy39Q.js";import{B as P,T as ae}from"./badge-FhSNMlHL.js";import{S as re}from"./separator-DoBxfjht.js";import{R as le}from"./robot-image-flneOwZu.js";import{u as ne}from"./use-matches-polling-BtT3E1gu.js";import{u as ie}from"./use-alliances-polling-CV8EJDca.js";import{S as H,C as K}from"./square-pen-BAC17ZOz.js";import{T as de}from"./trending-up-DkZQ6DMR.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],oe=W("arrow-left",ce);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Q=W("camera",me);function ue(C=8){const d=new Uint8Array(C);return crypto.getRandomValues(d),Array.from(d,p=>p.toString(16).padStart(2,"0")).join("")}function Te(){const d=ee().teamId,p=se(),{matches:w}=ne(),{alliances:E}=ie(),{data:a,isLoading:z,error:O}=$({queryKey:["teams","detail",d],queryFn:async()=>{const{data:s,error:t}=await g.from("teams").select("id, number, name, robot_image_url").eq("id",d).single();if(t)throw t;return s}}),{data:V}=$({queryKey:["auth","user"],queryFn:async()=>{const{data:{user:s}}=await g.auth.getUser();return{user:s}}}),G=V?.user,[L,k]=i.useState(""),[S,q]=i.useState(""),[m,I]=i.useState(null),[_,u]=i.useState(null),[M,R]=i.useState(!1),[x,F]=i.useState(!1);i.useEffect(()=>{a&&(k(String(a.number??"")),q(a.name??""))},[a]);const J=i.useMemo(()=>m?URL.createObjectURL(m):a?.robot_image_url??null,[m,a]),c=i.useMemo(()=>!a||!w||!E?[]:w.filter(s=>{const t=String(s.red||"").split(",").map(l=>l.trim())||[],n=String(s.blue||"").split(",").map(l=>l.trim())||[];return t.includes(a.number.toString())||n.includes(a.number.toString())}).map(s=>{const n=(String(s.red||"").split(",").map(l=>l.trim())||[]).includes(a.number.toString());return{...s,alliance:n?"red":"blue",allianceName:n?s.red_alliance_id:s.blue_alliance_id,teamScore:n?s.red_score:s.blue_score,opponentScore:n?s.blue_score:s.red_score,won:n?(s.red_score||0)>(s.blue_score||0):(s.blue_score||0)>(s.red_score||0),isTie:s.red_score===s.blue_score&&s.red_score!==null}}).sort((s,t)=>!s.scheduled_at&&!t.scheduled_at?0:s.scheduled_at?t.scheduled_at?new Date(t.scheduled_at).getTime()-new Date(s.scheduled_at).getTime():-1:1),[a,w,E]),o=i.useMemo(()=>{if(!c.length)return null;const s=c.filter(r=>r.teamScore!==null&&r.opponentScore!==null),t=s.filter(r=>r.won).length,n=s.filter(r=>!r.won&&!r.isTie).length,l=s.filter(r=>r.isTie).length,h=s.reduce((r,j)=>r+(j.teamScore||0),0),f=s.length>0?h/s.length:0;return{played:s.length,wins:t,losses:n,ties:l,totalScore:h,avgScore:f,winRate:s.length>0?t/s.length*100:0}},[c]),X=te({mutationFn:async s=>{const{number:t,name:n,file:l}=s;let h=a?.robot_image_url??null;if(l){const r=(l.name.split(".").pop()||"png").toLowerCase(),j=`images/${Date.now()}_${ue(6)}.${r}`,{error:U}=await g.storage.from("robots").upload(j,l,{cacheControl:"3600",upsert:!1,contentType:l.type});if(U)throw U;const{data:Z}=g.storage.from("robots").getPublicUrl(j);h=Z.publicUrl}const{error:f}=await g.from("teams").update({number:t,name:n,robot_image_url:h}).eq("id",d);if(f)throw f},onSuccess:()=>{p.invalidateQueries({queryKey:["teams","list"]}),p.invalidateQueries({queryKey:["teams","detail",d]}),u("Saved successfully!"),I(null),F(!1)},onError:s=>{const t=s instanceof Error?s.message:"Failed to save";u(t)},onSettled:()=>R(!1)});async function Y(s){s.preventDefault(),u(null);const t=Number(L);if(!t||t<=0){u("Enter a valid team number.");return}if(!S.trim()){u("Enter a team name.");return}R(!0),X.mutate({number:t,name:S.trim(),file:m})}return z?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading team..."})]})})}):O||!a?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-600 text-lg",children:"Team not found."}),e.jsx(D,{to:"/teams",className:"text-primary hover:underline mt-2 inline-block",children:"Back to Teams"})]})}):e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(D,{to:"/teams",className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),"Back to Teams"]}),e.jsx(re,{orientation:"vertical",className:"h-6"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Team ",a.number]}),e.jsx("p",{className:"text-lg text-muted-foreground",children:a.name})]})]}),G&&e.jsxs(A,{onClick:()=>F(!x),variant:x?"outline":"default",className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),x?"Cancel Edit":"Edit Team"]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[400px_1fr]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsx(b,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Team Robot"]})}),e.jsxs(y,{className:"p-4",children:[e.jsx("div",{className:"rounded-lg overflow-hidden border bg-muted",children:m?e.jsx("img",{src:J??void 0,alt:"Team robot",className:"w-full h-64 object-cover"}):a?.robot_image_url?e.jsx(le,{team:a,className:"w-full h-64",ratio:16/9}):e.jsx("div",{className:"w-full h-64 grid place-items-center text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No robot image"})]})})}),x&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(T,{className:"text-sm font-medium",htmlFor:"robot-file",children:"Update Robot Image"}),e.jsx("input",{id:"robot-file",type:"file",accept:"image/*",onChange:s=>I(s.target.files?.[0]??null),className:"w-full rounded-md border px-3 py-2 file:mr-3 file:rounded-md file:border file:px-3 file:py-1.5 file:bg-background"})]})]})]}),o&&e.jsxs(N,{children:[e.jsx(b,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5"}),"Season Statistics"]})}),e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 rounded-lg bg-blue-50 dark:bg-blue-950/30",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:o.played}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Matches"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-green-50 dark:bg-green-950/30",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.wins}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Wins"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-yellow-50 dark:bg-yellow-950/30",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:o.ties}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ties"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-red-50 dark:bg-red-950/30",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:o.losses}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Losses"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold",children:[o.winRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Win Rate"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:o.avgScore.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Avg Score"})]})]})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[x&&e.jsxs(N,{children:[e.jsx(b,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Edit Team Information"]})}),e.jsx(y,{className:"p-4",children:e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(T,{htmlFor:"team-number",className:"text-sm font-medium",children:"Team Number"}),e.jsx(B,{id:"team-number",type:"number",min:1,required:!0,value:L,onChange:s=>k(s.target.value),placeholder:"e.g. 6328"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(T,{htmlFor:"team-name",className:"text-sm font-medium",children:"Team Name"}),e.jsx(B,{id:"team-name",type:"text",required:!0,value:S,onChange:s=>q(s.target.value),placeholder:"Mechanical Advantage"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{type:"submit",disabled:M,className:"flex items-center gap-2",children:M?"Saving...":"Save Changes"}),_&&e.jsx("span",{className:`text-sm ${_.includes("success")?"text-green-600":"text-red-600"}`,children:_})]})]})})]}),e.jsxs(N,{children:[e.jsx(b,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Match History",c.length>0&&e.jsxs(P,{className:"ml-2",children:[c.length," matches"]})]})}),e.jsx(y,{className:"p-4",children:c.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No matches played yet"}),e.jsx("p",{className:"text-sm",children:"This team hasn't participated in any matches"})]}):e.jsx("div",{className:"space-y-3",children:c.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-card hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`
                          w-3 h-3 rounded-full ${s.alliance==="red"?"bg-red-500":"bg-blue-500"}
                        `}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name||`Match ${s.id}`}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.scheduled_at?new Date(s.scheduled_at).toLocaleDateString():"Unscheduled"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Score"}),e.jsx("div",{className:"font-semibold",children:s.teamScore??"-"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"vs"}),e.jsx("div",{className:"font-semibold",children:s.opponentScore??"-"})]}),e.jsx("div",{className:"flex items-center gap-1",children:s.isTie?e.jsx(P,{children:"TIE"}):s.won?e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"WIN"})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"LOSS"})})]})]},s.id))})})]})]})]})]})}export{Te as default};
