import{r as c,j as e,s as g}from"./index-WvZcqDcg.js";import{u as h}from"./useQuery-DTQ6mRtF.js";import{R as b}from"./robot-image-flneOwZu.js";import{u as M}from"./use-matches-polling-BtT3E1gu.js";async function F(s){if(s.length===0)return{};const{data:r,error:n}=await g.from("alliances").select("id, name").in("id",s);if(n)throw n;const i={};return(r??[]).forEach(a=>{i[a.id]=a.name}),i}async function R(s){if(s.length===0)return[];const{data:r,error:n}=await g.from("alliance_teams").select("id, alliance_id, team_id, slot").in("alliance_id",s);if(n)throw n;return r??[]}async function q(s){if(s.length===0)return[];const{data:r,error:n}=await g.from("teams").select("id, number, name, robot_image_url").in("id",s);if(n)throw n;return r??[]}function k(){const{matches:s,isLoading:r,error:n}=M(),i=s.filter(l=>l.red_score==null&&l.blue_score==null);i.sort((l,t)=>{const A=l.scheduled_at?new Date(l.scheduled_at).getTime():Number.NEGATIVE_INFINITY,I=t.scheduled_at?new Date(t.scheduled_at).getTime():Number.NEGATIVE_INFINITY;return A-I});const a=i.length>0?i[0]:null,d=c.useMemo(()=>a?[a.red_alliance_id,a.blue_alliance_id]:[],[a]),{data:m={},isLoading:N,error:p}=h({queryKey:["alliances","names",d.sort().join(",")],queryFn:()=>F(d),enabled:d.length>0}),{data:o=[],isLoading:j,error:v}=h({queryKey:["alliance_teams","byAlliances",d.sort().join(",")],queryFn:()=>R(d),enabled:d.length>0}),x=c.useMemo(()=>Array.from(new Set(o.map(l=>l.team_id))),[o]),{data:f=[],isLoading:y,error:w}=h({queryKey:["teams","byIds",x.sort().join(",")],queryFn:()=>q(x),enabled:x.length>0}),u=c.useMemo(()=>new Map(f.map(l=>[l.id,l])),[f]),E=c.useMemo(()=>{const l=[null,null,null,null];return o.filter(t=>t.alliance_id===a?.red_alliance_id).forEach(t=>{t.slot>=1&&t.slot<=4&&(l[t.slot-1]=u.get(t.team_id)??null)}),l},[o,u,a?.red_alliance_id]),L=c.useMemo(()=>{const l=[null,null,null,null];return o.filter(t=>t.alliance_id===a?.blue_alliance_id).forEach(t=>{t.slot>=1&&t.slot<=4&&(l[t.slot-1]=u.get(t.team_id)??null)}),l},[o,u,a?.blue_alliance_id]),T=r||N||j||y,_=n||p||v||w;return T?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loadingâ€¦"}):_?e.jsxs("p",{className:"text-red-600",children:["Error: ",String(_)]}):a?e.jsxs("div",{className:"min-h-dvh w-full p-4 md:p-8 lg:p-10",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-2xl md:text-3xl opacity-70",children:"Up Next"}),e.jsxs("div",{className:"text-3xl md:text-5xl font-bold",children:[m[a.red_alliance_id]??"Red Alliance"," vs ",m[a.blue_alliance_id]??"Blue Alliance"]}),a.scheduled_at&&e.jsx("div",{className:"text-lg md:text-2xl opacity-70 mt-2",children:new Date(a.scheduled_at).toLocaleTimeString()})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-4 text-white bg-red-600 inline-block px-4 py-1 rounded",children:m[a.red_alliance_id]??"Red Alliance"}),e.jsx("ul",{className:"grid gap-4",children:E.map((l,t)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[240px_1fr] items-center",children:[e.jsx(b,{team:l??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9}),e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",l.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:l.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})})]})},`r-${t}`))})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-4 text-white bg-blue-600 inline-block px-4 py-1 rounded",children:m[a.blue_alliance_id]??"Blue Alliance"}),e.jsx("ul",{className:"grid gap-4",children:L.map((l,t)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[1fr_240px] items-center",children:[e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold text-right",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",l.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:l.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})}),e.jsx(b,{team:l??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9})]})},`b-${t}`))})]})]})]}):e.jsx("p",{className:"text-muted-foreground",children:"No unplayed matches."})}export{k as default};
