import{u as L,r as n,j as s,s as o}from"./index-BzX4-QBV.js";import{L as h,I as m}from"./label-8Tublvoj.js";function q(){const k=L(),[i,N]=n.useState(""),[g,P]=n.useState(""),[f,a]=n.useState(null),[c,d]=n.useState(!1),[w,l]=n.useState(!1),[u,x]=n.useState(""),[y,b]=n.useState("");n.useEffect(()=>{async function t(){try{const e=new URL(window.location.href),r=e.searchParams.get("type"),v=e.searchParams.get("code");if(v){const{error:p}=await o.auth.exchangeCodeForSession(v);if(!p){l(!0),window.history.replaceState({},"",e.origin+e.pathname);return}}if(window.location.hash.includes("access_token")){const p=new URLSearchParams(window.location.hash.slice(1)),j=p.get("access_token")??void 0,S=p.get("refresh_token")??void 0;if(j&&S){const{error:R}=await o.auth.setSession({access_token:j,refresh_token:S});if(!R){l(!0),window.history.replaceState({},"",e.origin+e.pathname);return}}}r==="recovery"&&l(!0)}catch{}}t()},[]);async function C(t){t.preventDefault(),a(null),d(!0);try{const{error:e}=await o.auth.signInWithPassword({email:i,password:g});if(e)throw e;k("/")}catch(e){const r=e instanceof Error?e.message:"Unable to sign in.";a(`Error: ${r}`)}finally{d(!1)}}async function E(t){if(t.preventDefault(),a(null),!i){a("Enter your email first.");return}try{const e=`${window.location.origin}/noreaster/update-password`,{error:r}=await o.auth.resetPasswordForEmail(i,{redirectTo:e});if(r)throw r;a("Password reset link sent. Check your email.")}catch(e){const r=e instanceof Error?e.message:"Unable to send reset link.";a(`Error: ${r}`)}}async function U(t){if(t.preventDefault(),a(null),u.length<8){a("Password must be at least 8 characters.");return}if(u!==y){a("Passwords do not match.");return}d(!0);try{const{error:e}=await o.auth.updateUser({password:u});if(e)throw e;a("Password updated. You can now sign in."),l(!1),x(""),b("")}catch(e){const r=e instanceof Error?e.message:"Unable to update password.";a(`Error: ${r}`)}finally{d(!1)}}return s.jsxs("div",{className:"max-w-sm mx-auto",children:[s.jsx("h1",{className:"text-2xl font-semibold mb-4",children:w?"Reset password":"Sign in"}),w?s.jsxs("form",{onSubmit:U,className:"space-y-3",children:[s.jsxs("div",{className:"grid gap-1.5",children:[s.jsx(h,{children:"New password"}),s.jsx(m,{type:"password",required:!0,value:u,onChange:t=>x(t.target.value),autoComplete:"new-password"})]}),s.jsxs("div",{className:"grid gap-1.5",children:[s.jsx(h,{children:"Confirm new password"}),s.jsx(m,{type:"password",required:!0,value:y,onChange:t=>b(t.target.value),autoComplete:"new-password"})]}),s.jsx("button",{disabled:c,type:"submit",className:"rounded-md bg-black text-white px-3 py-2 hover:opacity-90 disabled:opacity-60 dark:bg-white dark:text-black",children:c?"Saving...":"Update password"})]}):s.jsxs("form",{onSubmit:C,className:"space-y-3",children:[s.jsxs("div",{className:"grid gap-1.5",children:[s.jsx(h,{children:"Email"}),s.jsx(m,{type:"email",required:!0,value:i,onChange:t=>N(t.target.value),autoComplete:"username"})]}),s.jsxs("div",{className:"grid gap-1.5",children:[s.jsx(h,{children:"Password"}),s.jsx(m,{type:"password",required:!0,value:g,onChange:t=>P(t.target.value),autoComplete:"current-password"})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{disabled:c,type:"submit",className:"rounded-md bg-black text-white px-3 py-2 hover:opacity-90 disabled:opacity-60 dark:bg-white dark:text-black",children:c?"Signing in...":"Sign in"}),s.jsx("button",{type:"button",onClick:E,className:"text-sm underline opacity-90 hover:opacity-100",children:"Forgot password?"})]})]}),f&&s.jsx("p",{className:"mt-3 text-sm opacity-80",children:f}),!w&&s.jsx("div",{className:"mt-6 text-sm text-muted-foreground space-y-2",children:s.jsx("p",{children:"Sign-up is disabled. Ask an admin to create your account or change your password."})})]})}export{q as default};
