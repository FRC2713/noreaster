import{r,j as s}from"./index-BarHRCZW.js";import{s as o}from"./client-BhtMMbbE.js";function R(){const[n,v]=r.useState(""),[m,k]=r.useState(""),[w,a]=r.useState(null),[i,d]=r.useState(!1),[h,l]=r.useState(!1),[c,f]=r.useState(""),[y,g]=r.useState("");r.useEffect(()=>{async function t(){try{const e=new URL(window.location.href),u=e.searchParams.get("type"),x=e.searchParams.get("code");if(x){const{error:p}=await o.auth.exchangeCodeForSession(x);if(!p){l(!0),window.history.replaceState({},"",e.origin+e.pathname);return}}if(window.location.hash.includes("access_token")){const p=new URLSearchParams(window.location.hash.slice(1)),b=p.get("access_token")??void 0,S=p.get("refresh_token")??void 0;if(b&&S){const{error:C}=await o.auth.setSession({access_token:b,refresh_token:S});if(!C){l(!0),window.history.replaceState({},"",e.origin+e.pathname);return}}}u==="recovery"&&l(!0)}catch{}}t()},[]);async function P(t){t.preventDefault(),a(null),d(!0);try{const{error:e}=await o.auth.signInWithPassword({email:n,password:m});if(e)throw e;a("Signed in!")}catch(e){a(`Error: ${e?.message||"Unable to sign in."}`)}finally{d(!1)}}async function j(t){if(t.preventDefault(),a(null),!n){a("Enter your email first.");return}try{const e=`${window.location.origin}/noreaster/update-password`,{error:u}=await o.auth.resetPasswordForEmail(n,{redirectTo:e});if(u)throw u;a("Password reset link sent. Check your email.")}catch(e){a(`Error: ${e?.message||"Unable to send reset link."}`)}}async function N(t){if(t.preventDefault(),a(null),c.length<8){a("Password must be at least 8 characters.");return}if(c!==y){a("Passwords do not match.");return}d(!0);try{const{error:e}=await o.auth.updateUser({password:c});if(e)throw e;a("Password updated. You can now sign in."),l(!1),f(""),g("")}catch(e){a(`Error: ${e?.message||"Unable to update password."}`)}finally{d(!1)}}return s.jsxs("div",{className:"max-w-sm",children:[s.jsx("h1",{className:"text-2xl font-semibold mb-4",children:h?"Reset password":"Sign in"}),h?s.jsxs("form",{onSubmit:N,className:"space-y-3",children:[s.jsx("input",{type:"password",required:!0,value:c,onChange:t=>f(t.target.value),placeholder:"New password",className:"w-full rounded-md border px-3 py-2 outline-hidden",autoComplete:"new-password"}),s.jsx("input",{type:"password",required:!0,value:y,onChange:t=>g(t.target.value),placeholder:"Confirm new password",className:"w-full rounded-md border px-3 py-2 outline-hidden",autoComplete:"new-password"}),s.jsx("button",{disabled:i,type:"submit",className:"rounded-md bg-black text-white px-3 py-2 hover:opacity-90 disabled:opacity-60 dark:bg-white dark:text-black",children:i?"Saving...":"Update password"})]}):s.jsxs("form",{onSubmit:P,className:"space-y-3",children:[s.jsx("input",{type:"email",required:!0,value:n,onChange:t=>v(t.target.value),placeholder:"you@example.com",className:"w-full rounded-md border px-3 py-2 outline-hidden",autoComplete:"username"}),s.jsx("input",{type:"password",required:!0,value:m,onChange:t=>k(t.target.value),placeholder:"Password",className:"w-full rounded-md border px-3 py-2 outline-hidden",autoComplete:"current-password"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{disabled:i,type:"submit",className:"rounded-md bg-black text-white px-3 py-2 hover:opacity-90 disabled:opacity-60 dark:bg-white dark:text-black",children:i?"Signing in...":"Sign in"}),s.jsx("button",{type:"button",onClick:j,className:"text-sm underline opacity-90 hover:opacity-100",children:"Forgot password?"})]})]}),w&&s.jsx("p",{className:"mt-3 text-sm opacity-80",children:w}),!h&&s.jsxs("div",{className:"mt-6 text-sm text-muted-foreground space-y-2",children:[s.jsx("p",{children:"Sign-up is disabled. Ask an admin to create your account or change your password."}),s.jsx("p",{children:"Admins: In Supabase Dashboard → Authentication → Providers → Email, disable new signups. To change a user's password, open Authentication → Users → select user → Reset Password."})]})]})}export{R as default};
