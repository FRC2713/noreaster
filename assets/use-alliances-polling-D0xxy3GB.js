import{c as i}from"./query-vendor-BivveeUn.js";import{s}from"./index-eDSu_bsY.js";async function w(){const{data:t,error:a}=await s.from("alliances").select("id, name, created_at, emblem_image_url").order("created_at",{ascending:!0});if(a)throw a;return t||[]}async function L(){const{data:t,error:a}=await s.from("teams").select("id, number, name, robot_image_url");if(a)throw a;return t||[]}async function b(){const{data:t,error:a}=await s.from("alliance_teams").select("id, alliance_id, team_id, slot");if(a)throw a;return t||[]}function U(){const{data:t=[],isLoading:a,error:d,dataUpdatedAt:m}=i({queryKey:["alliances","polling"],queryFn:w,refetchInterval:1e4,refetchIntervalInBackground:!0,staleTime:0,gcTime:3e5}),{data:o=[],isLoading:u,error:f}=i({queryKey:["teams","polling"],queryFn:L,refetchInterval:1e4,refetchIntervalInBackground:!0,staleTime:0,gcTime:300*1e3}),{data:g=[],isLoading:_,error:p,dataUpdatedAt:h}=i({queryKey:["alliance_teams","polling"],queryFn:b,refetchInterval:1e4,refetchIntervalInBackground:!0,staleTime:0,gcTime:300*1e3}),n=t.map(e=>({id:e.id,name:e.name,created_at:e.created_at,emblem_image_url:e.emblem_image_url,teams:[null,null,null,null]})),y=new Map(o.map(e=>[e.id,e]));g.forEach(e=>{const r=n.findIndex(T=>T.id===e.alliance_id);r!==-1&&e.slot>=1&&e.slot<=4&&(n[r].teams[e.slot-1]=y.get(e.team_id)??null)});const A=a||u||_,l=d||f||p,c=Math.max(m||0,h||0),I=e=>e?t.find(r=>r.id===e)?.name??`Alliance ${e}`:"TBD";return{alliances:n,teams:o,isLoading:A,error:l?l instanceof Error?l.message:"Failed to fetch alliances data":null,lastUpdated:c?new Date(c):null,getAllianceName:I}}export{U as u};
