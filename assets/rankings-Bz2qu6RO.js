import{r as _,j as n}from"./index-C5-kOk9t.js";import{u as h}from"./useQuery-DnkZB-PI.js";import{s as g}from"./client-B-U_EDy9.js";import{B as E}from"./button-DWTdNbF1.js";import{R}from"./rankings-table-CWgghm_R.js";import{c as v}from"./createLucideIcon-BuTPBc5c.js";import"./index-TBylrUac.js";import"./utils-CBfrqCZ4.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],N=v("maximize",j);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]],L=v("minimize",z);async function F(){const{data:l,error:o}=await g.from("alliances").select("id, name").order("name");if(o)throw o;return l??[]}async function W(){const{data:l,error:o}=await g.from("matches").select("id, red_alliance_id, blue_alliance_id, red_score, blue_score, red_coral_rp, red_auto_rp, red_barge_rp, blue_coral_rp, blue_auto_rp, blue_barge_rp");if(o)throw o;return l??[]}function G(){const{data:l=[],isLoading:o,error:x}=h({queryKey:["alliances","list"],queryFn:F}),{data:d=[],isLoading:b,error:y}=h({queryKey:["matches","list"],queryFn:W}),M=_.useMemo(()=>{if(!l.length)return[];const s=new Map;l.forEach(e=>{s.set(e.id,{id:e.id,name:e.name,played:0,wins:0,losses:0,ties:0,totalRp:0,totalScore:0,countedScoreMatches:0})});const i=(e,r)=>{const t=s.get(e);t&&(t.totalRp+=r)};for(const e of d){const r=s.get(e.red_alliance_id),t=s.get(e.blue_alliance_id);if(!r||!t)continue;e.red_score!=null&&e.blue_score!=null&&(r.played+=1,t.played+=1,e.red_score>e.blue_score?(r.wins+=1,t.losses+=1,i(r.id,3)):e.red_score<e.blue_score?(t.wins+=1,r.losses+=1,i(t.id,3)):(r.ties+=1,t.ties+=1,i(r.id,1),i(t.id,1)),i(r.id,(e.red_coral_rp?1:0)+(e.red_auto_rp?1:0)+(e.red_barge_rp?1:0)),i(t.id,(e.blue_coral_rp?1:0)+(e.blue_auto_rp?1:0)+(e.blue_barge_rp?1:0)),r.totalScore+=e.red_score,r.countedScoreMatches+=1,t.totalScore+=e.blue_score,t.countedScoreMatches+=1)}const p=Array.from(s.values()).map(e=>{const r=e.played>0?e.totalRp/e.played:0,t=e.countedScoreMatches>0?e.totalScore/e.countedScoreMatches:0;return{...e,avgRp:r,avgScore:t}});function S(e,r){let t=0,c=0;for(const a of d)(a.red_alliance_id===e||a.blue_alliance_id===e)&&(a.red_alliance_id===r||a.blue_alliance_id===r)&&(a.red_score==null||a.blue_score==null||(a.red_score>a.blue_score?a.red_alliance_id===e?t++:a.red_alliance_id===r&&c++:a.blue_score>a.red_score&&(a.blue_alliance_id===e?t++:a.blue_alliance_id===r&&c++)));return{aWins:t,bWins:c}}return p.sort((e,r)=>{if(r.avgRp!==e.avgRp)return r.avgRp-e.avgRp;const{aWins:t,bWins:c}=S(e.id,r.id);return t!==c?c-t:r.avgScore!==e.avgScore?r.avgScore-e.avgScore:e.name.localeCompare(r.name)}),p.map((e,r)=>({rank:r+1,...e}))},[l,d]),f=o||b,u=x||y,[m,k]=_.useState(!!document.fullscreenElement);_.useEffect(()=>{const s=()=>k(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",s),()=>document.removeEventListener("fullscreenchange",s)},[]);function w(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}return n.jsxs("div",{className:"min-h-dvh w-full p-6 md:p-8 lg:p-10 flex flex-col gap-6 overflow-hidden",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h1",{className:"text-4xl md:text-5xl font-bold tracking-tight",children:"Rankings"}),n.jsx(E,{variant:"ghost",size:"icon",onClick:w,className:"rounded-full size-12","aria-label":m?"Exit full screen":"Enter full screen",title:m?"Exit full screen":"Enter full screen",children:m?n.jsx(L,{className:"size-6"}):n.jsx(N,{className:"size-6"})})]}),f&&n.jsx("p",{className:"text-2xl text-muted-foreground",children:"Loadingâ€¦"}),u&&n.jsx("p",{className:"text-2xl text-red-600",children:String(u)}),!f&&!u&&n.jsx("div",{className:"flex-1 overflow-auto rounded-lg border",children:n.jsx(R,{rows:M,showWLT:!0,showRank:!0,size:"lg"})})]})}export{G as default};
