import{r as a,h as H,f as W,j as e,d as X,P as Q,i as G,v as J,t as q,b as V,a as Y,L as Z,s as U}from"./index-BmdevC1f.js";import{B as T}from"./button-0VHX3KvR.js";import{u as ee}from"./useQuery-Cgu6KS9_.js";import{u as te}from"./useMutation-ck4VRZr6.js";import{u as se}from"./use-alliances-polling-C7wt8F3W.js";import{u as re}from"./matches-store-DsfI4gDF.js";import"./react-yI-qG6nv.js";function ae(t){const r=a.useRef({value:t,previous:t});return a.useMemo(()=>(r.current.value!==t&&(r.current.previous=r.current.value,r.current.value=t),r.current.previous),[t])}var k="Switch",[ne,xe]=X(k),[oe,ce]=ne(k),F=a.forwardRef((t,r)=>{const{__scopeSwitch:n,name:l,checked:o,defaultChecked:h,required:d,disabled:c,value:s="on",onCheckedChange:p,form:u,...m}=t,[f,b]=a.useState(null),v=H(r,x=>b(x)),j=a.useRef(!1),S=f?u||!!f.closest("form"):!0,[g,y]=W({prop:o,defaultProp:h??!1,onChange:p,caller:k});return e.jsxs(oe,{scope:n,checked:g,disabled:c,children:[e.jsx(Q.button,{type:"button",role:"switch","aria-checked":g,"aria-required":d,"data-state":O(g),"data-disabled":c?"":void 0,disabled:c,value:s,...m,ref:v,onClick:G(t.onClick,x=>{y(_=>!_),S&&(j.current=x.isPropagationStopped(),j.current||x.stopPropagation())})}),S&&e.jsx(z,{control:f,bubbles:!j.current,name:l,value:s,checked:g,required:d,disabled:c,form:u,style:{transform:"translateX(-100%)"}})]})});F.displayName=k;var K="SwitchThumb",$=a.forwardRef((t,r)=>{const{__scopeSwitch:n,...l}=t,o=ce(K,n);return e.jsx(Q.span,{"data-state":O(o.checked),"data-disabled":o.disabled?"":void 0,...l,ref:r})});$.displayName=K;var le="SwitchBubbleInput",z=a.forwardRef(({__scopeSwitch:t,control:r,checked:n,bubbles:l=!0,...o},h)=>{const d=a.useRef(null),c=H(d,h),s=ae(n),p=J(r);return a.useEffect(()=>{const u=d.current;if(!u)return;const m=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(m,"checked").set;if(s!==n&&b){const v=new Event("click",{bubbles:l});b.call(u,n),u.dispatchEvent(v)}},[s,n,l]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...o,tabIndex:-1,ref:c,style:{...o.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});z.displayName=le;function O(t){return t?"checked":"unchecked"}var D=F,ie=$;const w=a.forwardRef(({className:t,...r},n)=>e.jsx(D,{ref:n,className:q("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...r,children:e.jsx(ie,{className:q("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));w.displayName=D.displayName;function L({title:t,coral:r,auto:n,barge:l,onCoralChange:o,onAutoChange:h,onBargeChange:d,className:c}){return e.jsxs("div",{className:`${c??""} border rounded-md p-4`,children:[e.jsx("div",{className:"font-semibold mb-3 text-lg",children:t}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Coral RP"}),e.jsx(w,{checked:r,onCheckedChange:o})]}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Auto RP"}),e.jsx(w,{checked:n,onCheckedChange:h})]}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Barge RP"}),e.jsx(w,{checked:l,onCheckedChange:d})]})]})}async function de(t){const{data:r,error:n}=await U.from("matches").select("*").eq("id",t).single();if(n)throw n;return r??[]}function ve(){const{matchId:t}=V(),r=Y(),{alliances:n}=se(),{getMatchById:l}=re(),o=t?l(t):void 0,{data:h,isLoading:d,error:c}=ee({queryKey:["matches","byId",t],queryFn:async()=>de(t),enabled:!!t&&!o}),s=o||h,[p,u]=a.useState(""),[m,f]=a.useState(""),[b,v]=a.useState(!1),[j,S]=a.useState(!1),[g,y]=a.useState(!1),[x,_]=a.useState(!1),[N,R]=a.useState(!1),[B,P]=a.useState(!1),[E,M]=a.useState(null);a.useEffect(()=>{s&&(u(s.red_score!=null?String(s.red_score):""),f(s.blue_score!=null?String(s.blue_score):""),v(!!s.red_coral_rp),S(!!s.red_auto_rp),y(!!s.red_barge_rp),_(!!s.blue_coral_rp),R(!!s.blue_auto_rp),P(!!s.blue_barge_rp))},[s]);const A=te({mutationFn:async()=>{if(!t)return;const i={red_score:p?Number(p):null,blue_score:m?Number(m):null,red_coral_rp:b,red_auto_rp:j,red_barge_rp:g,blue_coral_rp:x,blue_auto_rp:N,blue_barge_rp:B},{error:C}=await U.from("matches").update(i).eq("id",t);if(C)throw C},onSuccess:()=>{M("Saved."),r.invalidateQueries({queryKey:["matches","polling"]}),r.invalidateQueries({queryKey:["matches","byId",t]})},onError:i=>M(`Save failed: ${i?.message??"Unknown error"}`)});function I(i){return n.find(C=>C.id===i)?.name??i}return t?d?e.jsx("p",{children:"Loading match…"}):c?e.jsxs("p",{className:"text-red-600",children:["Error: ",String(c)]}):s?e.jsxs("div",{className:"space-y-6 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{to:"/matches",children:e.jsx(T,{variant:"ghost",children:"← Back"})}),e.jsx("h1",{className:"text-2xl font-semibold",children:s.name??"Edit Match"})]}),e.jsxs("div",{className:"rounded-md border p-4",children:[e.jsxs("div",{className:"mb-4 font-semibold text-xl",children:[I(s.red_alliance_id)," vs ",I(s.blue_alliance_id)]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 text-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Red Score"}),e.jsx("input",{type:"number",value:p,onChange:i=>u(i.target.value),className:"w-full rounded-md border px-3 py-3 text-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Blue Score"}),e.jsx("input",{type:"number",value:m,onChange:i=>f(i.target.value),className:"w-full rounded-md border px-3 py-3 text-lg"})]})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsx(L,{title:"Red Alliance RP",coral:b,auto:j,barge:g,onCoralChange:v,onAutoChange:S,onBargeChange:y}),e.jsx(L,{title:"Blue Alliance RP",coral:x,auto:N,barge:B,onCoralChange:_,onAutoChange:R,onBargeChange:P})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{onClick:()=>A.mutate(),disabled:A.isPending,children:"Save"}),E&&e.jsx("span",{className:"text-sm opacity-80",children:E})]})]}):e.jsx("p",{children:"Match not found"}):e.jsx("p",{children:"Missing match id"})}export{ve as default};
