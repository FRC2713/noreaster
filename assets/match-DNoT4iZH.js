import{r,k as T,h as F,j as e,e as K,P as q,l as O,x as D,w as A,b as W,a as X,L as G,s as J}from"./index-WvZcqDcg.js";import{B as M}from"./button-BjoTGIGe.js";import{u as V}from"./useMutation-CLm6HZOQ.js";import{u as Y}from"./use-alliances-polling-CV8EJDca.js";import{u as Z}from"./use-match-Cp_XwAwQ.js";import"./useQuery-DTQ6mRtF.js";function ee(s){const a=r.useRef({value:s,previous:s});return r.useMemo(()=>(a.current.value!==s&&(a.current.previous=a.current.value,a.current.value=s),a.current.previous),[s])}var k="Switch",[te,he]=K(k),[se,re]=te(k),L=r.forwardRef((s,a)=>{const{__scopeSwitch:n,name:t,checked:o,defaultChecked:h,required:c,disabled:l,value:d="on",onCheckedChange:x,form:u,...g}=s,[p,m]=r.useState(null),v=T(a,b=>m(b)),j=r.useRef(!1),S=p?u||!!p.closest("form"):!0,[f,_]=F({prop:o,defaultProp:h??!1,onChange:x,caller:k});return e.jsxs(se,{scope:n,checked:f,disabled:l,children:[e.jsx(q.button,{type:"button",role:"switch","aria-checked":f,"aria-required":c,"data-state":$(f),"data-disabled":l?"":void 0,disabled:l,value:d,...g,ref:v,onClick:O(s.onClick,b=>{_(C=>!C),S&&(j.current=b.isPropagationStopped(),j.current||b.stopPropagation())})}),S&&e.jsx(Q,{control:p,bubbles:!j.current,name:t,value:d,checked:f,required:c,disabled:l,form:u,style:{transform:"translateX(-100%)"}})]})});L.displayName=k;var H="SwitchThumb",U=r.forwardRef((s,a)=>{const{__scopeSwitch:n,...t}=s,o=re(H,n);return e.jsx(q.span,{"data-state":$(o.checked),"data-disabled":o.disabled?"":void 0,...t,ref:a})});U.displayName=H;var ae="SwitchBubbleInput",Q=r.forwardRef(({__scopeSwitch:s,control:a,checked:n,bubbles:t=!0,...o},h)=>{const c=r.useRef(null),l=T(c,h),d=ee(n),x=D(a);return r.useEffect(()=>{const u=c.current;if(!u)return;const g=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(g,"checked").set;if(d!==n&&m){const v=new Event("click",{bubbles:t});m.call(u,n),u.dispatchEvent(v)}},[d,n,t]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...o,tabIndex:-1,ref:l,style:{...o.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Q.displayName=ae;function $(s){return s?"checked":"unchecked"}var z=L,ne=U;const y=r.forwardRef(({className:s,...a},n)=>e.jsx(z,{ref:n,className:A("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...a,children:e.jsx(ne,{className:A("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));y.displayName=z.displayName;function I({title:s,coral:a,auto:n,barge:t,onCoralChange:o,onAutoChange:h,onBargeChange:c,className:l}){return e.jsxs("div",{className:`${l??""} border rounded-md p-4`,children:[e.jsx("div",{className:"font-semibold mb-3 text-lg",children:s}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Coral RP"}),e.jsx(y,{checked:a,onCheckedChange:o})]}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Auto RP"}),e.jsx(y,{checked:n,onCheckedChange:h})]}),e.jsxs("label",{className:"flex items-center justify-between py-2 text-lg",children:[e.jsx("span",{children:"Barge RP"}),e.jsx(y,{checked:t,onCheckedChange:c})]})]})}function pe(){const{matchId:s}=W(),a=X(),{alliances:n}=Y(),{data:t,isLoading:o,error:h}=Z(s),[c,l]=r.useState(""),[d,x]=r.useState(""),[u,g]=r.useState(!1),[p,m]=r.useState(!1),[v,j]=r.useState(!1),[S,f]=r.useState(!1),[_,b]=r.useState(!1),[C,N]=r.useState(!1),[R,B]=r.useState(null);r.useEffect(()=>{t&&(l(t.red_score!=null?String(t.red_score):""),x(t.blue_score!=null?String(t.blue_score):""),g(!!t.red_coral_rp),m(!!t.red_auto_rp),j(!!t.red_barge_rp),f(!!t.blue_coral_rp),b(!!t.blue_auto_rp),N(!!t.blue_barge_rp))},[t]);const P=V({mutationFn:async()=>{if(!s)return;const i={red_score:c?Number(c):null,blue_score:d?Number(d):null,red_coral_rp:u,red_auto_rp:p,red_barge_rp:v,blue_coral_rp:S,blue_auto_rp:_,blue_barge_rp:C},{error:w}=await J.from("matches").update(i).eq("id",s);if(w)throw w},onSuccess:()=>{B("Saved."),a.invalidateQueries({queryKey:["matches","polling"]}),a.invalidateQueries({queryKey:["matches","byId",s]})},onError:i=>B(`Save failed: ${i?.message??"Unknown error"}`)});function E(i){return n.find(w=>w.id===i)?.name??i}return s?o?e.jsx("p",{children:"Loading match…"}):h?e.jsxs("p",{className:"text-red-600",children:["Error: ",String(h)]}):t?e.jsxs("div",{className:"space-y-6 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{to:"/matches",children:e.jsx(M,{variant:"ghost",children:"← Back"})}),e.jsx("h1",{className:"text-2xl font-semibold",children:t.name??"Edit Match"})]}),e.jsxs("div",{className:"rounded-md border p-4",children:[e.jsxs("div",{className:"mb-4 font-semibold text-xl",children:[E(t.red_alliance_id)," vs ",E(t.blue_alliance_id)]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 text-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Red Score"}),e.jsx("input",{type:"number",value:c,onChange:i=>l(i.target.value),className:"w-full rounded-md border px-3 py-3 text-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Blue Score"}),e.jsx("input",{type:"number",value:d,onChange:i=>x(i.target.value),className:"w-full rounded-md border px-3 py-3 text-lg"})]})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsx(I,{title:"Red Alliance RP",coral:u,auto:p,barge:v,onCoralChange:g,onAutoChange:m,onBargeChange:j}),e.jsx(I,{title:"Blue Alliance RP",coral:S,auto:_,barge:C,onCoralChange:f,onAutoChange:b,onBargeChange:N})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{onClick:()=>P.mutate(),disabled:P.isPending,children:"Save"}),R&&e.jsx("span",{className:"text-sm opacity-80",children:R})]})]}):e.jsx("p",{children:"Match not found"}):e.jsx("p",{children:"Missing match id"})}export{pe as default};
