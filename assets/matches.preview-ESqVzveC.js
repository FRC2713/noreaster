import{r as c,j as e,s as g}from"./index-BmdevC1f.js";import{u as h}from"./useQuery-Cgu6KS9_.js";import{R as b}from"./robot-image-CQ6KlgD1.js";import{u as A}from"./matches-store-DsfI4gDF.js";import"./react-yI-qG6nv.js";async function R(s){if(s.length===0)return{};const{data:i,error:n}=await g.from("alliances").select("id, name").in("id",s);if(n)throw n;const o={};return(i??[]).forEach(t=>{o[t.id]=t.name}),o}async function q(s){if(s.length===0)return[];const{data:i,error:n}=await g.from("alliance_teams").select("id, alliance_id, team_id, slot").in("alliance_id",s);if(n)throw n;return i??[]}async function S(s){if(s.length===0)return[];const{data:i,error:n}=await g.from("teams").select("id, number, name, robot_image_url").in("id",s);if(n)throw n;return i??[]}function B(){const{getUpcomingMatches:s,isLoading:i,error:n}=A(),o=s(),t=o.length>0?o[0]:null,r=c.useMemo(()=>t?[t.red_alliance_id,t.blue_alliance_id]:[],[t]),{data:m={},isLoading:p,error:j}=h({queryKey:["alliances","names",r.sort().join(",")],queryFn:()=>R(r),enabled:r.length>0}),{data:d=[],isLoading:N,error:v}=h({queryKey:["alliance_teams","byAlliances",r.sort().join(",")],queryFn:()=>q(r),enabled:r.length>0}),x=c.useMemo(()=>Array.from(new Set(d.map(l=>l.team_id))),[d]),{data:f=[],isLoading:y,error:w}=h({queryKey:["teams","byIds",x.sort().join(",")],queryFn:()=>S(x),enabled:x.length>0}),u=c.useMemo(()=>new Map(f.map(l=>[l.id,l])),[f]),L=c.useMemo(()=>{const l=[null,null,null,null];return d.filter(a=>a.alliance_id===t?.red_alliance_id).forEach(a=>{a.slot>=1&&a.slot<=4&&(l[a.slot-1]=u.get(a.team_id)??null)}),l},[d,u,t?.red_alliance_id]),E=c.useMemo(()=>{const l=[null,null,null,null];return d.filter(a=>a.alliance_id===t?.blue_alliance_id).forEach(a=>{a.slot>=1&&a.slot<=4&&(l[a.slot-1]=u.get(a.team_id)??null)}),l},[d,u,t?.blue_alliance_id]),M=i||p||N||y,_=n||j||v||w;return M?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loadingâ€¦"}):_?e.jsxs("p",{className:"text-red-600",children:["Error: ",String(_)]}):t?e.jsxs("div",{className:"min-h-dvh w-full p-4 md:p-8 lg:p-10",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-2xl md:text-3xl opacity-70",children:"Up Next"}),e.jsxs("div",{className:"text-3xl md:text-5xl font-bold",children:[m[t.red_alliance_id]??"Red Alliance"," vs ",m[t.blue_alliance_id]??"Blue Alliance"]}),t.scheduled_at&&e.jsx("div",{className:"text-lg md:text-2xl opacity-70 mt-2",children:new Date(t.scheduled_at).toLocaleTimeString()})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-4 text-white bg-red-600 inline-block px-4 py-1 rounded",children:m[t.red_alliance_id]??"Red Alliance"}),e.jsx("ul",{className:"grid gap-4",children:L.map((l,a)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[240px_1fr] items-center",children:[e.jsx(b,{team:l??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9}),e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",l.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:l.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})})]})},`r-${a}`))})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl md:text-4xl font-bold mb-4 text-white bg-blue-600 inline-block px-4 py-1 rounded",children:m[t.blue_alliance_id]??"Blue Alliance"}),e.jsx("ul",{className:"grid gap-4",children:E.map((l,a)=>e.jsx("li",{className:"border rounded-md overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[1fr_240px] items-center",children:[e.jsx("div",{className:"p-4 text-2xl md:text-3xl font-semibold text-right",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["#",l.number]}),e.jsx("div",{className:"text-xl md:text-2xl opacity-80 font-normal",children:l.name})]}):e.jsx("div",{className:"text-muted-foreground",children:"Unassigned"})}),e.jsx(b,{team:l??{id:"_",number:0,name:"Unassigned",robot_image_url:null},className:"w-full bg-muted",ratio:16/9})]})},`b-${a}`))})]})]})]}):e.jsx("p",{className:"text-muted-foreground",children:"No unplayed matches."})}export{B as default};
