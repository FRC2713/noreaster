import{j as s}from"./ui-vendor-L3tEH77r.js";import{u as L,r as o}from"./react-vendor-BE_oCUfB.js";import{s as n}from"./index-OSJmVpKI.js";import{L as p,I as h}from"./label-DE1HoHhg.js";import"./supabase-vendor-BfNnX3KH.js";import"./utils-vendor-BC32Okw2.js";import"./icons-vendor-NdmwdHec.js";import"./query-vendor-DjGQMdFW.js";function T(){const k=L(),[i,N]=o.useState(""),[g,P]=o.useState(""),[f,a]=o.useState(null),[c,d]=o.useState(!1),[w,l]=o.useState(!1),[u,x]=o.useState(""),[y,b]=o.useState("");o.useEffect(()=>{async function t(){try{const e=new URL(window.location.href),r=e.searchParams.get("type"),v=e.searchParams.get("code");if(v){const{error:m}=await n.auth.exchangeCodeForSession(v);if(!m){l(!0),window.history.replaceState({},"",e.origin+e.pathname);return}}if(window.location.hash.includes("access_token")){const m=new URLSearchParams(window.location.hash.slice(1)),j=m.get("access_token")??void 0,S=m.get("refresh_token")??void 0;if(j&&S){const{error:R}=await n.auth.setSession({access_token:j,refresh_token:S});if(!R){l(!0),window.history.replaceState({},"",e.origin+e.pathname);return}}}r==="recovery"&&l(!0)}catch{}}t()},[]);async function C(t){t.preventDefault(),a(null),d(!0);try{const{error:e}=await n.auth.signInWithPassword({email:i,password:g});if(e)throw e;k("/")}catch(e){const r=e instanceof Error?e.message:"Unable to sign in.";a(`Error: ${r}`)}finally{d(!1)}}async function E(t){if(t.preventDefault(),a(null),!i){a("Enter your email first.");return}try{const e=`${window.location.origin}/noreaster/update-password`,{error:r}=await n.auth.resetPasswordForEmail(i,{redirectTo:e});if(r)throw r;a("Password reset link sent. Check your email.")}catch(e){const r=e instanceof Error?e.message:"Unable to send reset link.";a(`Error: ${r}`)}}async function U(t){if(t.preventDefault(),a(null),u.length<8){a("Password must be at least 8 characters.");return}if(u!==y){a("Passwords do not match.");return}d(!0);try{const{error:e}=await n.auth.updateUser({password:u});if(e)throw e;a("Password updated. You can now sign in."),l(!1),x(""),b("")}catch(e){const r=e instanceof Error?e.message:"Unable to update password.";a(`Error: ${r}`)}finally{d(!1)}}return s.jsxs("div",{className:"max-w-sm mx-auto",children:[s.jsx("h1",{className:"text-2xl font-semibold mb-4",children:w?"Reset password":"Sign in"}),w?s.jsxs("form",{onSubmit:U,className:"space-y-3",children:[s.jsxs("div",{className:"grid gap-1.5",children:[s.jsx(p,{children:"New password"}),s.jsx(h,{type:"password",required:!0,value:u,onChange:t=>x(t.target.value),autoComplete:"new-password"})]}),s.jsxs("div",{className:"grid gap-1.5",children:[s.jsx(p,{children:"Confirm new password"}),s.jsx(h,{type:"password",required:!0,value:y,onChange:t=>b(t.target.value),autoComplete:"new-password"})]}),s.jsx("button",{disabled:c,type:"submit",className:"rounded-md bg-black text-white px-3 py-2 hover:opacity-90 disabled:opacity-60 dark:bg-white dark:text-black",children:c?"Saving...":"Update password"})]}):s.jsxs("form",{onSubmit:C,className:"space-y-3",children:[s.jsxs("div",{className:"grid gap-1.5",children:[s.jsx(p,{children:"Email"}),s.jsx(h,{type:"email",required:!0,value:i,onChange:t=>N(t.target.value),autoComplete:"username"})]}),s.jsxs("div",{className:"grid gap-1.5",children:[s.jsx(p,{children:"Password"}),s.jsx(h,{type:"password",required:!0,value:g,onChange:t=>P(t.target.value),autoComplete:"current-password"})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{disabled:c,type:"submit",className:"rounded-md bg-black text-white px-3 py-2 hover:opacity-90 disabled:opacity-60 dark:bg-white dark:text-black",children:c?"Signing in...":"Sign in"}),s.jsx("button",{type:"button",onClick:E,className:"text-sm underline opacity-90 hover:opacity-100",children:"Forgot password?"})]})]}),f&&s.jsx("p",{className:"mt-3 text-sm opacity-80",children:f}),!w&&s.jsx("div",{className:"mt-6 text-sm text-muted-foreground space-y-2",children:s.jsx("p",{children:"Sign-up is disabled. Ask an admin to create your account or change your password."})})]})}export{T as default};
